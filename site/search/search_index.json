{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"StirrupJS","text":"<p>StirrupJS is a lightweight TypeScript/JavaScript framework for building AI agents. It differs from other agent frameworks by:</p> <ul> <li>Working with the model, not against it: StirrupJS gets out of the way and lets the model choose its own approach to completing tasks (similar to Claude Code). Many frameworks impose rigid workflows that can degrade results.</li> <li>Best practices and tools built-in: We analyzed the leading agents (Claude Code, Codex, and others) to understand and incorporate best practices relating to topics like context management and foundational tools (e.g., code execution).</li> <li>Fully customizable: Use StirrupJS as a package or as a starting template to build your own fully customized agents.</li> </ul>"},{"location":"#features","title":"Features","text":"<ul> <li>Essential tools built-in:<ul> <li>Online search / web browsing</li> <li>Code execution (local, Docker container, E2B sandbox)</li> <li>Document input and output</li> </ul> </li> <li>Skills system: Extend agents with modular, domain-specific instruction packages</li> <li>Flexible tool execution: A generic <code>Tool</code> interface allows easy tool definition and extension</li> <li>Context management: Automatically summarizes conversation history when approaching context limits</li> <li>Flexible provider support: Works with OpenAI-compatible APIs (OpenRouter, Together AI, OpenAI, etc.)</li> <li>Session management: Automatic file handling and tool lifecycle management</li> <li>Event-driven architecture: Monitor agent progress with EventEmitter</li> </ul>"},{"location":"#installation","title":"Installation","text":"<pre><code>npm install stirrupjs\n# or\nyarn add stirrupjs\n# or\npnpm add stirrupjs\n</code></pre>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code>import { Agent, SIMPLE_FINISH_TOOL, DEFAULT_TOOLS } from 'stirrupjs';\nimport { ChatCompletionsClient } from 'stirrupjs/clients';\n\n// Create an LLM client (uses OpenAI-compatible API)\nconst client = new ChatCompletionsClient({\n  apiKey: process.env.OPENROUTER_API_KEY,\n  baseURL: 'https://openrouter.ai/api/v1',\n  model: 'anthropic/claude-sonnet-4.5',\n});\n\n// Create an agent with tools\nconst agent = new Agent({\n  client,\n  name: 'assistant',\n  maxTurns: 10,\n  tools: DEFAULT_TOOLS,\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n\n// Use session to handle tool lifecycle and file outputs\nawait using session = agent.session();\n\n// Run the agent\nconst result = await session.run('What is 2 + 2?');\nconsole.log(result.finishParams?.reason);\n</code></pre> <p>Environment Variables</p> <p>This example uses OpenRouter. Set <code>OPENROUTER_API_KEY</code> in your environment before running.</p> <p>Web search requires a <code>BRAVE_API_KEY</code>. The agent will still work without it, but web search will be unavailable.</p>"},{"location":"#how-it-works","title":"How It Works","text":"<ul> <li><code>Agent</code> - Configures and runs the agent loop until a finish tool is called or max turns reached</li> <li><code>session()</code> - Sets up tools, manages files, and handles cleanup using <code>await using</code> (explicit resource management)</li> <li><code>Tool</code> - Define tools with Zod schema validation</li> <li><code>ToolProvider</code> - Manage tools that require lifecycle (connections, temp directories, etc.)</li> <li><code>DEFAULT_TOOLS</code> - Standard tools included by default: code execution and web tools</li> </ul>"},{"location":"#using-other-llm-providers","title":"Using Other LLM Providers","text":"<p>For non-OpenAI providers, change the base URL of the <code>ChatCompletionsClient</code>:</p>"},{"location":"#openrouter-recommended","title":"OpenRouter (Recommended)","text":"<pre><code>const client = new ChatCompletionsClient({\n  apiKey: process.env.OPENROUTER_API_KEY,\n  baseURL: 'https://openrouter.ai/api/v1',\n  model: 'anthropic/claude-sonnet-4.5',\n});\n</code></pre>"},{"location":"#together-ai","title":"Together AI","text":"<pre><code>const client = new ChatCompletionsClient({\n  apiKey: process.env.TOGETHER_API_KEY,\n  baseURL: 'https://api.together.xyz/v1',\n  model: 'meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo',\n});\n</code></pre>"},{"location":"#openai","title":"OpenAI","text":"<pre><code>const client = new ChatCompletionsClient({\n  apiKey: process.env.OPENAI_API_KEY,\n  baseURL: 'https://api.openai.com/v1',\n  model: 'gpt-5.2',\n});\n</code></pre>"},{"location":"#default-tools","title":"Default Tools","text":"<p>When you create an <code>Agent</code> without specifying tools, it uses <code>DEFAULT_TOOLS</code>:</p> Tool Provider Tools Provided Description <code>LocalCodeExecToolProvider</code> <code>code_exec</code> Execute shell commands in an isolated temp directory. Use <code>uv</code> to manage packages. <code>WebToolProvider</code> <code>web_fetch</code>, <code>web_search</code> Fetch web pages and search (search requires <code>BRAVE_API_KEY</code>)"},{"location":"#extending-with-pre-built-tools","title":"Extending with Pre-Built Tools","text":"<pre><code>import { Agent, SIMPLE_FINISH_TOOL, CALCULATOR_TOOL } from 'stirrupjs';\nimport { WebToolProvider } from 'stirrupjs/tools';\n\nconst agent = new Agent({\n  client,\n  tools: [\n    new WebToolProvider(),\n    CALCULATOR_TOOL,\n  ],\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre>"},{"location":"#defining-custom-tools","title":"Defining Custom Tools","text":"<pre><code>import { z } from 'zod';\nimport type { Tool, ToolResult } from 'stirrupjs';\nimport { ToolUseCountMetadata } from 'stirrupjs';\n\n// Define parameter schema\nconst WeatherParamsSchema = z.object({\n  location: z.string().describe('City name or location'),\n  unit: z.enum(['celsius', 'fahrenheit']).default('celsius'),\n});\n\n// Create tool\nconst weatherTool: Tool&lt;typeof WeatherParamsSchema, ToolUseCountMetadata&gt; = {\n  name: 'get_weather',\n  description: 'Get current weather for a location',\n  parameters: WeatherParamsSchema,\n  executor: async (params) =&gt; {\n    const temp = params.unit === 'celsius' ? 22 : 72;\n    return {\n      content: `Weather in ${params.location}: ${temp}\u00b0${params.unit === 'celsius' ? 'C' : 'F'}`,\n      metadata: new ToolUseCountMetadata(1),\n    };\n  },\n};\n</code></pre>"},{"location":"#full-customization","title":"Full Customization","text":"<p>For deep customization of the framework internals, you can clone and modify StirrupJS locally:</p> <pre><code># Clone the repository\ngit clone https://github.com/ArtificialAnalysis/stirrup-js.git\ncd stirrup-js\n\n# Install dependencies\nnpm install\n\n# Build the project\nnpm run build\n</code></pre> <p>See the Full Customization guide for more details.</p>"},{"location":"#next-steps","title":"Next Steps","text":"<ul> <li>Getting Started - Installation and first agent tutorial</li> <li>Core Concepts - Understand Agent, Tools, and Sessions</li> <li>Examples - Working examples for common patterns</li> <li>Creating Tools - Build your own tools</li> <li>Skills - Extend agents with domain-specific expertise</li> </ul>"},{"location":"concepts/","title":"Core Concepts","text":"<p>This page covers the fundamental concepts of StirrupJS: Agent, Client, Tools, Sessions, and Logging.</p>"},{"location":"concepts/#agent","title":"Agent","text":"<p>The <code>Agent</code> class orchestrates the agent loop: receiving user input, calling the LLM, executing tools, and returning results.</p>"},{"location":"concepts/#configuration","title":"Configuration","text":"<pre><code>import { Agent, SIMPLE_FINISH_TOOL, DEFAULT_TOOLS } from 'stirrupjs';\n\nconst agent = new Agent({\n  client,              // Required: LLM client\n  name: 'assistant',   // Optional: Agent name (default: 'agent')\n  maxTurns: 10,        // Optional: Maximum turns (default: 25)\n  tools: DEFAULT_TOOLS,           // Optional: Tools available to agent\n  finishTool: SIMPLE_FINISH_TOOL, // Optional: Tool to signal completion\n  systemPrompt: 'You are a helpful assistant.',  // Optional: System prompt\n  contextSummarizationCutoff: 0.75,  // Optional: When to summarize (0-1)\n  runSyncInThread: false,            // Optional: Run sync executors in worker threads\n  textOnlyToolResponses: false,      // Optional: Convert tool responses to text\n});\n</code></pre>"},{"location":"concepts/#agent-loop","title":"Agent Loop","text":"<p>The agent loop runs until: 1. The finish tool is called 2. Maximum turns is reached 3. An error occurs 4. The operation is cancelled (via AbortController)</p> <p>Each turn: 1. Send messages to LLM 2. Receive response (may include tool calls) 3. Execute tool calls 4. Add results to message history 5. Repeat</p>"},{"location":"concepts/#context-management","title":"Context Management","text":"<p>When the conversation approaches the context limit (default: 75%), StirrupJS automatically summarizes older messages to free up space. This uses a smaller, faster model to preserve important context while reducing token usage.</p> <pre><code>const agent = new Agent({\n  client,\n  contextSummarizationCutoff: 0.8,  // Summarize at 80% of context window\n});\n</code></pre>"},{"location":"concepts/#client","title":"Client","text":"<p>The client handles communication with the LLM. StirrupJS includes <code>ChatCompletionsClient</code> for OpenAI-compatible APIs.</p>"},{"location":"concepts/#chatcompletionsclient","title":"ChatCompletionsClient","text":"<pre><code>import { ChatCompletionsClient } from 'stirrupjs/clients';\n\nconst client = new ChatCompletionsClient({\n  apiKey: process.env.OPENROUTER_API_KEY!,\n  baseURL: 'https://openrouter.ai/api/v1',\n  model: 'anthropic/claude-sonnet-4.5',\n  maxTokens: 100_000,  // Optional: Max tokens in response\n});\n</code></pre> <p>Parameters: - <code>apiKey</code>: API key for authentication - <code>baseURL</code>: API endpoint URL - <code>model</code>: Model identifier - <code>maxTokens</code>: Maximum tokens in response (optional)</p>"},{"location":"concepts/#custom-clients","title":"Custom Clients","text":"<p>Implement the <code>Client</code> interface to use other LLM providers:</p> <pre><code>interface Client {\n  name: string;\n  complete(\n    messages: ChatMessage[],\n    tools: ToolDefinition[],\n    signal?: AbortSignal\n  ): Promise&lt;ChatCompletionResponse&gt;;\n}\n</code></pre> <p>See Custom Clients for details.</p>"},{"location":"concepts/#tools","title":"Tools","text":"<p>Tools extend the agent's capabilities. StirrupJS includes built-in tools and makes it easy to create custom ones.</p>"},{"location":"concepts/#default_tools","title":"DEFAULT_TOOLS","text":"<p>By default, agents have access to:</p> <pre><code>import { DEFAULT_TOOLS } from 'stirrupjs';\n\n// DEFAULT_TOOLS = [\n//   new LocalCodeExecToolProvider(),\n//   new WebToolProvider(),\n// ]\n</code></pre> <p>LocalCodeExecToolProvider provides: - <code>code_exec</code>: Execute shell commands in isolated temp directory   - Uses <code>uv</code> for Python package management   - Returns exit code, stdout, stderr as XML</p> <p>WebToolProvider provides: - <code>web_fetch</code>: Fetch and parse web pages - <code>web_search</code>: Search the web (requires <code>BRAVE_API_KEY</code>)</p>"},{"location":"concepts/#custom-tools","title":"Custom Tools","text":"<p>Define custom tools with Zod schemas:</p> <pre><code>import { z } from 'zod';\nimport type { Tool, ToolResult } from 'stirrupjs';\nimport { ToolUseCountMetadata } from 'stirrupjs';\n\nconst WeatherParamsSchema = z.object({\n  location: z.string().describe('City name'),\n  unit: z.enum(['celsius', 'fahrenheit']).default('celsius'),\n});\n\nconst weatherTool: Tool&lt;typeof WeatherParamsSchema, ToolUseCountMetadata&gt; = {\n  name: 'get_weather',\n  description: 'Get current weather',\n  parameters: WeatherParamsSchema,\n  executor: async (params) =&gt; {\n    const temp = params.unit === 'celsius' ? 22 : 72;\n    return {\n      content: `Weather: ${temp}\u00b0${params.unit === 'celsius' ? 'C' : 'F'}`,\n      metadata: new ToolUseCountMetadata(1),\n    };\n  },\n};\n</code></pre> <p>See Creating Tools for detailed examples.</p>"},{"location":"concepts/#tool-providers","title":"Tool Providers","text":"<p>Tool providers manage tools with lifecycle requirements (connections, temp directories, etc.):</p> <pre><code>import { ToolProvider } from 'stirrupjs';\n\nclass DatabaseToolProvider implements ToolProvider {\n  name = 'database';\n  private connection: any;\n\n  async initialize() {\n    this.connection = await connectToDatabase();\n  }\n\n  getTools() {\n    return [queryTool, insertTool];\n  }\n\n  async dispose() {\n    await this.connection.close();\n  }\n}\n</code></pre> <p>See Tool Providers for details.</p>"},{"location":"concepts/#sub-agents","title":"Sub-Agents","text":"<p>Convert agents into tools to delegate specialized tasks:</p> <pre><code>const researchAgent = new Agent({\n  client,\n  name: 'researcher',\n  tools: [new WebToolProvider()],\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n\nconst coordinatorAgent = new Agent({\n  client,\n  name: 'coordinator',\n  tools: [\n    researchAgent.toTool('Delegate research tasks'),\n  ],\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre> <p>See Sub-Agents for complex patterns.</p>"},{"location":"concepts/#session","title":"Session","text":"<p>Sessions manage tool lifecycle and file handling using explicit resource management (<code>await using</code>).</p>"},{"location":"concepts/#basic-usage","title":"Basic Usage","text":"<pre><code>await using session = agent.session();\nconst result = await session.run('Your task');\n// Automatic cleanup when scope exits\n</code></pre>"},{"location":"concepts/#session-configuration","title":"Session Configuration","text":"<pre><code>await using session = agent.session({\n  outputDir: './output',      // Save output files here\n  inputFiles: ['data.csv'],   // Upload input files (files, globs, or directories)\n  skillsDir: 'skills',        // Upload skills + add skills list to system prompt\n});\n</code></pre>"},{"location":"concepts/#manual-disposal","title":"Manual Disposal","text":"<p>For cases where <code>await using</code> isn't suitable:</p> <pre><code>const session = agent.session();\ntry {\n  await session.run('task');\n} finally {\n  await session[Symbol.asyncDispose]();\n}\n</code></pre>"},{"location":"concepts/#understanding-agent-output","title":"Understanding Agent Output","text":"<p>The <code>run()</code> method returns an <code>AgentRunResult</code>:</p> <pre><code>import type { AgentRunResult, FinishParams } from 'stirrupjs';\n\nconst result: AgentRunResult&lt;FinishParams&gt; = await session.run('task');\n</code></pre>"},{"location":"concepts/#result-properties","title":"Result Properties","text":"<p><code>finishParams</code> - Agent's final response (if completed successfully): <pre><code>result.finishParams?.reason  // string: Summary of what was done\nresult.finishParams?.paths   // string[]: Output file paths\n</code></pre></p> <p><code>messageHistory</code> - Conversation history grouped by summarization: <pre><code>result.messageHistory  // ChatMessage[][]\n// Each array represents a \"chunk\" of conversation\n// Chunks are separated by summarization events\n</code></pre></p> <p><code>runMetadata</code> - Tool usage statistics: <pre><code>result.runMetadata  // Record&lt;string, unknown&gt;\n// Example: { code_exec: { numUses: 3 }, web_fetch: { numUses: 1 } }\n</code></pre></p>"},{"location":"concepts/#receiving-output-files-from-the-agent","title":"Receiving Output Files from the Agent","text":"<p>Files created by the agent can be automatically saved by specifying an <code>outputDir</code>:</p> <pre><code>await using session = agent.session({ outputDir: './results' });\n\nconst result = await session.run('Create a chart');\n\n// Files in result.finishParams.paths are saved to ./results/\n</code></pre>"},{"location":"concepts/#how-it-works","title":"How It Works","text":"<ol> <li>Agent creates files in its execution environment</li> <li>Agent calls finish tool with <code>paths</code> parameter listing files</li> <li>On session disposal, files are copied from execution environment to <code>outputDir</code></li> <li>Console logs saved files</li> </ol>"},{"location":"concepts/#sub-agents-and-file-transfer","title":"Sub-Agents and File Transfer","text":"<ul> <li>Root agent (depth 0): Saves files to local filesystem</li> <li>Sub-agents (depth &gt; 0): Transfer files to parent's execution environment</li> </ul> <p>This allows sub-agents to create files that the parent agent can access.</p>"},{"location":"concepts/#passing-input-files-to-the-agent","title":"Passing Input Files to the Agent","text":"<pre><code>await using session = agent.session({\n  inputFiles: [\n    'data.csv',              // Single file\n    'config/*.json',         // Glob pattern\n    ['file1.txt', 'file2.txt']  // Array\n  ],\n});\n</code></pre>"},{"location":"concepts/#loading-skills","title":"Loading Skills","text":"<p>Skills are modular packages that extend agent capabilities with domain-specific instructions and scripts. Pass a skills directory to make them available:</p> <pre><code>await using session = agent.session({\n  skillsDir: 'skills',\n  outputDir: './output',\n});\n\nawait session.run('Analyze the data using the data_analysis skill');\n</code></pre> <p>The agent receives a list of available skills in its system prompt and can read the full instructions via: <code>cat skills/&lt;skill_name&gt;/SKILL.md</code>. See Skills Guide for full documentation.</p>"},{"location":"concepts/#logging-and-monitoring","title":"Logging and Monitoring","text":""},{"location":"concepts/#structured-logging","title":"Structured Logging","text":"<p>The easiest way to monitor agent activity:</p> <pre><code>import { createStructuredLogger } from 'stirrupjs';\n\nconst cleanup = createStructuredLogger(agent, {\n  level: 'debug',  // 'debug' shows all details, 'info' shows summary\n});\n\nawait using session = agent.session();\nawait session.run('task');\n\ncleanup();  // Stop logging\n</code></pre> <p>Output includes: - Turn-by-turn progress - Assistant messages - Tool calls with parameters - Sub-agent activity (indented) - Token usage - Final summary</p>"},{"location":"concepts/#event-listeners","title":"Event Listeners","text":"<p>For custom monitoring:</p> <pre><code>agent.on('run:start', ({ task }) =&gt; {\n  console.log('Started:', task);\n});\n\nagent.on('turn:start', ({ turn, maxTurns }) =&gt; {\n  console.log(`Turn ${turn + 1}/${maxTurns}`);\n});\n\nagent.on('message:assistant', ({ content, toolCalls }) =&gt; {\n  console.log('Assistant:', content);\n});\n\nagent.on('tool:complete', ({ name, success, result }) =&gt; {\n  console.log(`Tool ${name}: ${success ? 'success' : 'failure'}`);\n});\n\nagent.on('run:complete', ({ result, duration }) =&gt; {\n  console.log(`Completed in ${duration}ms`);\n});\n\nagent.on('run:error', ({ error }) =&gt; {\n  console.error('Error:', error);\n});\n</code></pre> <p>See API: Logging for all available events.</p>"},{"location":"concepts/#streaming-events","title":"Streaming Events","text":"<p>Use async iteration to stream events:</p> <pre><code>for await (const event of agent.runStream('task')) {\n  switch (event.type) {\n    case 'start':\n      console.log('Started');\n      break;\n    case 'turn:start':\n      console.log(`Turn ${event.turn}`);\n      break;\n    case 'message':\n      console.log(event.message);\n      break;\n    case 'complete':\n      console.log('Done:', event.result);\n      break;\n  }\n}\n</code></pre>"},{"location":"concepts/#cancellation","title":"Cancellation","text":"<p>Cancel agent execution using <code>AbortController</code>:</p> <pre><code>const controller = new AbortController();\n\n// Cancel after timeout\nsetTimeout(() =&gt; controller.abort('Timeout'), 30000);\n\nawait using session = agent.session();\ntry {\n  await session.run('Long task', { signal: controller.signal });\n} catch (error) {\n  if (error.name === 'AbortError') {\n    console.log('Cancelled:', error.message);\n  }\n}\n</code></pre> <p>Or cancel based on events:</p> <pre><code>let turnCount = 0;\nagent.on('turn:start', () =&gt; {\n  if (++turnCount &gt;= 5) {\n    controller.abort('Too many turns');\n  }\n});\n</code></pre>"},{"location":"concepts/#next-steps","title":"Next Steps","text":"<ul> <li>Examples - Working code for common patterns</li> <li>Creating Tools - Build custom tools</li> <li>Tool Providers - Manage tool lifecycle</li> <li>Sub-Agents - Complex delegation patterns</li> <li>Code Execution - Different execution backends</li> </ul>"},{"location":"examples/","title":"Examples","text":"<p>This page contains working examples for common patterns and use cases.</p>"},{"location":"examples/#basic-usage","title":"Basic Usage","text":""},{"location":"examples/#simple-agent","title":"Simple Agent","text":"<p>Create an agent that can use tools and finish when done:</p> <pre><code>import { Agent, SIMPLE_FINISH_TOOL, DEFAULT_TOOLS } from 'stirrupjs';\nimport { ChatCompletionsClient } from 'stirrupjs/clients';\n\nconst client = new ChatCompletionsClient({\n  apiKey: process.env.OPENROUTER_API_KEY!,\n  baseURL: 'https://openrouter.ai/api/v1',\n  model: 'anthropic/claude-sonnet-4.5',\n});\n\nconst agent = new Agent({\n  client,\n  name: 'assistant',\n  maxTurns: 10,\n  tools: DEFAULT_TOOLS,\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n\nawait using session = agent.session();\nconst result = await session.run('What is 2 + 2?');\n\nconsole.log(result.finishParams?.reason);\n</code></pre>"},{"location":"examples/#with-custom-system-prompt","title":"With Custom System Prompt","text":"<pre><code>const agent = new Agent({\n  client,\n  name: 'code-reviewer',\n  maxTurns: 10,\n  tools: DEFAULT_TOOLS,\n  finishTool: SIMPLE_FINISH_TOOL,\n  systemPrompt: 'You are an expert code reviewer. Analyze code for bugs, performance issues, and best practices.',\n});\n</code></pre>"},{"location":"examples/#custom-tools","title":"Custom Tools","text":""},{"location":"examples/#simple-calculator-tool","title":"Simple Calculator Tool","text":"<pre><code>import { z } from 'zod';\nimport type { Tool, ToolResult } from 'stirrupjs';\nimport { ToolUseCountMetadata } from 'stirrupjs';\n\nconst CalculatorParamsSchema = z.object({\n  expression: z.string().describe('Mathematical expression to evaluate'),\n});\n\nconst calculatorTool: Tool&lt;typeof CalculatorParamsSchema, ToolUseCountMetadata&gt; = {\n  name: 'calculator',\n  description: 'Evaluate mathematical expressions',\n  parameters: CalculatorParamsSchema,\n  executor: async (params) =&gt; {\n    try {\n      // WARNING: eval is dangerous - use a proper math parser in production\n      const result = eval(params.expression);\n      return {\n        content: `Result: ${result}`,\n        metadata: new ToolUseCountMetadata(1),\n      };\n    } catch (error) {\n      return {\n        content: `Error: ${error.message}`,\n        metadata: new ToolUseCountMetadata(1),\n      };\n    }\n  },\n};\n\nconst agent = new Agent({\n  client,\n  tools: [calculatorTool],\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre>"},{"location":"examples/#weather-api-tool","title":"Weather API Tool","text":"<pre><code>import { z } from 'zod';\nimport type { Tool, ToolResult } from 'stirrupjs';\nimport { ToolUseCountMetadata } from 'stirrupjs';\n\nconst WeatherParamsSchema = z.object({\n  location: z.string().describe('City name or location'),\n  unit: z.enum(['celsius', 'fahrenheit']).default('celsius').describe('Temperature unit'),\n});\n\nconst weatherTool: Tool&lt;typeof WeatherParamsSchema, ToolUseCountMetadata&gt; = {\n  name: 'get_weather',\n  description: 'Get current weather for a location',\n  parameters: WeatherParamsSchema,\n  executor: async (params): Promise&lt;ToolResult&lt;ToolUseCountMetadata&gt;&gt; =&gt; {\n    // In production, call a real weather API\n    const temp = params.unit === 'celsius' ? 22 : 72;\n    const condition = 'Sunny';\n\n    return {\n      content: `Weather in ${params.location}: ${temp}\u00b0${params.unit === 'celsius' ? 'C' : 'F'}, ${condition}`,\n      metadata: new ToolUseCountMetadata(1),\n    };\n  },\n};\n</code></pre>"},{"location":"examples/#database-query-tool","title":"Database Query Tool","text":"<pre><code>import { z } from 'zod';\nimport type { Tool, ToolResult } from 'stirrupjs';\nimport { ToolUseCountMetadata } from 'stirrupjs';\n\nconst DbQueryParamsSchema = z.object({\n  query: z.string().describe('SQL query to execute'),\n});\n\nconst databaseTool: Tool&lt;typeof DbQueryParamsSchema, ToolUseCountMetadata&gt; = {\n  name: 'db_query',\n  description: 'Execute a SQL query against the database',\n  parameters: DbQueryParamsSchema,\n  executor: async (params) =&gt; {\n    // In production, use a proper database client with parameterized queries\n    console.log(`Executing query: ${params.query}`);\n\n    const results = [\n      { id: 1, name: 'Alice', age: 30 },\n      { id: 2, name: 'Bob', age: 25 },\n    ];\n\n    return {\n      content: `Query results (${results.length} rows):\\n${JSON.stringify(results, null, 2)}`,\n      metadata: new ToolUseCountMetadata(1),\n    };\n  },\n};\n</code></pre>"},{"location":"examples/#sub-agents","title":"Sub-Agents","text":"<p>Delegate specialized tasks to sub-agents:</p> <pre><code>import { Agent, SIMPLE_FINISH_TOOL, CALCULATOR_TOOL } from 'stirrupjs';\nimport { WebToolProvider } from 'stirrupjs/tools';\n\n// Create specialized sub-agents\nconst researchAgent = new Agent({\n  client,\n  name: 'researcher',\n  maxTurns: 5,\n  tools: [new WebToolProvider(180_000, process.env.BRAVE_API_KEY)],\n  finishTool: SIMPLE_FINISH_TOOL,\n  systemPrompt: 'You are a research specialist. Use web search to find accurate information.',\n});\n\nconst mathAgent = new Agent({\n  client,\n  name: 'mathematician',\n  maxTurns: 3,\n  tools: [CALCULATOR_TOOL],\n  finishTool: SIMPLE_FINISH_TOOL,\n  systemPrompt: 'You are a math specialist. Calculate precisely using the calculator tool.',\n});\n\n// Create coordinator that delegates to sub-agents\nconst coordinatorAgent = new Agent({\n  client,\n  name: 'coordinator',\n  maxTurns: 10,\n  tools: [\n    researchAgent.toTool('Delegate research tasks to the research specialist'),\n    mathAgent.toTool('Delegate math calculations to the math specialist'),\n  ],\n  finishTool: SIMPLE_FINISH_TOOL,\n  systemPrompt: `You are a task coordinator. Delegate tasks to specialized sub-agents:\n- Use 'researcher' for web search and research tasks\n- Use 'mathematician' for calculations and math problems`,\n});\n\nawait using session = coordinatorAgent.session();\nawait session.run('What is the population of Tokyo and what will it be in 5 years with 2% growth?');\n</code></pre>"},{"location":"examples/#event-monitoring","title":"Event Monitoring","text":""},{"location":"examples/#basic-event-listeners","title":"Basic Event Listeners","text":"<pre><code>const agent = new Agent({\n  client,\n  name: 'event-agent',\n  maxTurns: 5,\n  tools: DEFAULT_TOOLS,\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n\n// Listen to agent events\nagent.on('run:start', ({ task }) =&gt; {\n  console.log('\ud83d\ude80 Agent started');\n});\n\nagent.on('turn:start', ({ turn, maxTurns }) =&gt; {\n  console.log(`\ud83d\udccd Turn ${turn + 1}/${maxTurns}`);\n});\n\nagent.on('message:assistant', ({ content, toolCalls }) =&gt; {\n  if (content) console.log('\ud83d\udcac Assistant:', content.substring(0, 100));\n  if (toolCalls) console.log('\ud83d\udd27 Tools:', toolCalls.map(tc =&gt; tc.name).join(', '));\n});\n\nagent.on('tool:complete', ({ name, success }) =&gt; {\n  console.log(`${success ? '\u2705' : '\u274c'} Tool: ${name}`);\n});\n\nagent.on('run:complete', ({ result, duration }) =&gt; {\n  console.log(`\u2705 Completed in ${duration}ms`);\n});\n\nawait using session = agent.session();\nawait session.run('What is 2+2?');\n</code></pre>"},{"location":"examples/#streaming-events","title":"Streaming Events","text":"<pre><code>for await (const event of agent.runStream('What is 2+2?')) {\n  switch (event.type) {\n    case 'start':\n      console.log('\ud83d\ude80 Started');\n      break;\n    case 'turn:start':\n      console.log(`\ud83d\udccd Turn ${event.turn + 1}/${event.maxTurns}`);\n      break;\n    case 'message':\n      if (event.message.role === 'assistant') {\n        console.log('\ud83d\udcac Assistant:', event.message.content);\n      }\n      break;\n    case 'complete':\n      console.log('\u2705 Complete');\n      break;\n  }\n}\n</code></pre>"},{"location":"examples/#cancellation-with-abortcontroller","title":"Cancellation with AbortController","text":"<pre><code>const controller = new AbortController();\n\n// Cancel after 3 turns\nlet turnCount = 0;\nagent.on('turn:start', () =&gt; {\n  turnCount++;\n  if (turnCount &gt;= 3) {\n    console.log('\u23f0 Cancelling...');\n    controller.abort('Maximum turns reached');\n  }\n});\n\nawait using session = agent.session();\ntry {\n  await session.run('Count to 100', { signal: controller.signal });\n} catch (error) {\n  if (error.name === 'AbortError') {\n    console.log('\u2705 Successfully cancelled');\n  }\n}\n</code></pre>"},{"location":"examples/#structured-logging","title":"Structured Logging","text":"<p>The easiest way to monitor agent activity:</p> <pre><code>import { createStructuredLogger } from 'stirrupjs';\n\nconst cleanup = createStructuredLogger(agent, {\n  level: 'debug',  // or 'info'\n});\n\nawait using session = agent.session();\nawait session.run('Create a chart');\n\ncleanup();  // Stop logging\n</code></pre> <p>This automatically shows: - Turn-by-turn progress - Tool calls with parameters - Sub-agent activity (indented) - Token usage per turn - Final summary with totals</p>"},{"location":"examples/#file-handling","title":"File Handling","text":""},{"location":"examples/#saving-output-files","title":"Saving Output Files","text":"<pre><code>await using session = agent.session({ outputDir: './output' });\n\nconst result = await session.run('Create a chart of sales data');\n\n// Files listed in result.finishParams.paths are automatically saved to ./output/\nconsole.log('Saved files:', result.finishParams?.paths);\n</code></pre>"},{"location":"examples/#multiple-output-directories","title":"Multiple Output Directories","text":"<pre><code>// Save research results\nawait using session1 = agent.session({ outputDir: './research' });\nawait session1.run('Research topic and save summary');\n\n// Save analysis in different directory\nawait using session2 = agent.session({ outputDir: './analysis' });\nawait session2.run('Analyze data and create visualizations');\n</code></pre>"},{"location":"examples/#code-execution-backends","title":"Code Execution Backends","text":""},{"location":"examples/#local-execution-default","title":"Local Execution (Default)","text":"<pre><code>import { LocalCodeExecToolProvider } from 'stirrupjs/tools';\n\nconst agent = new Agent({\n  client,\n  tools: [new LocalCodeExecToolProvider()],\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre>"},{"location":"examples/#docker-execution","title":"Docker Execution","text":"<pre><code>import { DockerCodeExecToolProvider } from 'stirrupjs/tools';\n\nconst agent = new Agent({\n  client,\n  tools: [new DockerCodeExecToolProvider('python:3.12-slim')],\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre>"},{"location":"examples/#e2b-cloud-sandboxes","title":"E2B Cloud Sandboxes","text":"<pre><code>import { E2BCodeExecToolProvider } from 'stirrupjs/tools';\n\nconst agent = new Agent({\n  client,\n  tools: [new E2BCodeExecToolProvider({\n    apiKey: process.env.E2B_API_KEY!,\n    template: 'base',\n  })],\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre>"},{"location":"examples/#skills","title":"Skills","text":"<p>Load skills from a local <code>skills/</code> directory and make them available in the execution environment:</p> <pre><code>await using session = agent.session({\n  skillsDir: 'skills',\n  inputFiles: ['examples/skills/sample_data.csv'],\n  outputDir: './output/skills_example',\n});\n\nawait session.run('Use the data_analysis skill to analyze the CSV and create a chart.');\n</code></pre>"},{"location":"examples/#next-steps","title":"Next Steps","text":"<ul> <li>Creating Tools - Deep dive into custom tools</li> <li>Tool Providers - Managing tool lifecycle</li> <li>Sub-Agents - Complex delegation patterns</li> <li>Code Execution - Different execution backends</li> </ul>"},{"location":"getting-started/","title":"Getting Started","text":"<p>This guide walks you through installing StirrupJS and creating your first agent.</p>"},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<ul> <li>Node.js 18 or higher</li> <li>TypeScript 5.0 or higher (for TypeScript projects)</li> <li>An API key from your LLM provider (OpenRouter, OpenAI, Together AI, etc.)</li> </ul>"},{"location":"getting-started/#installation","title":"Installation","text":"<p>Install via npm, yarn, or pnpm:</p> <pre><code>npm install stirrupjs\n</code></pre> <pre><code>yarn add stirrupjs\n</code></pre> <pre><code>pnpm add stirrupjs\n</code></pre>"},{"location":"getting-started/#your-first-agent","title":"Your First Agent","text":"<p>Create a simple agent that can search the web and execute code:</p> <pre><code>import { Agent, SIMPLE_FINISH_TOOL, DEFAULT_TOOLS, createStructuredLogger } from 'stirrupjs';\nimport { ChatCompletionsClient } from 'stirrupjs/clients';\n\n// Create an LLM client\nconst client = new ChatCompletionsClient({\n  apiKey: process.env.OPENROUTER_API_KEY!,\n  baseURL: 'https://openrouter.ai/api/v1',\n  model: 'anthropic/claude-sonnet-4.5',\n  maxTokens: 100_000,\n});\n\n// Create an agent\nconst agent = new Agent({\n  client,\n  name: 'assistant',\n  maxTurns: 10,\n  tools: DEFAULT_TOOLS,\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n\n// Optional: Enable structured logging\nconst cleanup = createStructuredLogger(agent, { level: 'debug' });\n\n// Use session for automatic file handling\nawait using session = agent.session();\n\n// Run the agent\nconst result = await session.run('What is 2 + 2?');\n\nconsole.log('Result:', result.finishParams?.reason);\n\ncleanup();\n</code></pre> <p>Environment Variables</p> <p>This example uses OpenRouter. Set <code>OPENROUTER_API_KEY</code> in your environment before running.</p> <p>Web search requires a <code>BRAVE_API_KEY</code>. The agent will still work without it, but web search will be unavailable.</p>"},{"location":"getting-started/#tools","title":"Tools","text":"<p>By default, agents include code execution and web tools:</p> Tool Description <code>code_exec</code> Execute shell commands in an isolated temp directory. Use <code>uv</code> to manage packages. <code>web_fetch</code> Fetch and parse web pages <code>web_search</code> Search the web (requires <code>BRAVE_API_KEY</code>) <p>Extend with additional tools:</p> <pre><code>import { Agent, SIMPLE_FINISH_TOOL, CALCULATOR_TOOL } from 'stirrupjs';\nimport { WebToolProvider } from 'stirrupjs/tools';\n\nconst agent = new Agent({\n  client,\n  tools: [\n    new WebToolProvider(),\n    CALCULATOR_TOOL,\n  ],\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre> <p>\u2192 See Tools for full documentation on DEFAULT_TOOLS, custom tools, sub-agents, and tool providers.</p>"},{"location":"getting-started/#choosing-a-client","title":"Choosing a Client","text":"<p>StirrupJS ships with support for OpenAI-Compatible APIs.</p>"},{"location":"getting-started/#openai-compatible-apis","title":"OpenAI-Compatible APIs","text":"<p>Use <code>ChatCompletionsClient</code> to use OpenAI models or OpenAI-compatible APIs:</p> <pre><code>// OpenRouter (recommended for accessing multiple models)\nconst client = new ChatCompletionsClient({\n  apiKey: process.env.OPENROUTER_API_KEY!,\n  baseURL: 'https://openrouter.ai/api/v1',\n  model: 'anthropic/claude-sonnet-4.5',\n});\n\n// Together AI\nconst client = new ChatCompletionsClient({\n  apiKey: process.env.TOGETHER_API_KEY!,\n  baseURL: 'https://api.together.xyz/v1',\n  model: 'meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo',\n});\n\n// OpenAI\nconst client = new ChatCompletionsClient({\n  apiKey: process.env.OPENAI_API_KEY!,\n  baseURL: 'https://api.openai.com/v1',\n  model: 'gpt-5.2',\n});\n</code></pre> <p>\u2192 See Client for parameter tables and creating custom clients.</p>"},{"location":"getting-started/#understanding-the-output","title":"Understanding the Output","text":"<p>The <code>run()</code> method returns an <code>AgentRunResult</code>:</p> <pre><code>import type { AgentRunResult, FinishParams } from 'stirrupjs';\n\nconst result: AgentRunResult&lt;FinishParams&gt; = await session.run(\"Your task\");\n\n// result contains:\n// - finishParams: Agent's final response (reason, paths)\n// - messageHistory: Conversation message history\n// - runMetadata: Aggregated tool metadata\n</code></pre> <p>Result structure:</p> <ul> <li><code>finishParams</code>: Agent's final response with <code>reason</code> (string) and <code>paths</code> (string[])</li> <li><code>messageHistory</code>: Full conversation grouped by summarization events</li> <li><code>runMetadata</code>: Tool usage statistics (e.g., <code>{ code_exec: { numUses: 3 } }</code>)</li> </ul> <p>\u2192 See Understanding Agent Output for details.</p>"},{"location":"getting-started/#uploading-input-files","title":"Uploading Input Files","text":"<p>Provide files to the agent's execution environment:</p> <pre><code>await using session = agent.session({\n  inputFiles: ['data.csv', 'config.json'],\n  outputDir: './output',\n});\n\nawait session.run('Analyze the data');\n</code></pre> <p>Input Files - Coming Soon</p> <p>File upload functionality is currently under development. The <code>inputFiles</code> parameter is reserved for future use.</p>"},{"location":"getting-started/#saving-output-files","title":"Saving Output Files","text":"<p>Save files created by the agent by providing an output directory:</p> <pre><code>await using session = agent.session({ outputDir: './results' });\n\nconst result = await session.run('Create a chart');\n\n// Files in result.finishParams.paths are automatically saved to ./results/\n</code></pre> <p>The session automatically: 1. Detects files listed in <code>finishParams.paths</code> 2. Copies them from the execution environment to <code>outputDir</code> 3. Reports saved files on cleanup</p> <p>\u2192 See Receiving Output Files for details.</p>"},{"location":"getting-started/#using-explicit-resource-management","title":"Using Explicit Resource Management","text":"<p>StirrupJS uses the <code>await using</code> syntax for automatic cleanup:</p> <pre><code>// Automatic cleanup when scope exits\nawait using session = agent.session();\nawait session.run('task');\n// Session automatically disposed here\n</code></pre> <p>For manual control:</p> <pre><code>const session = agent.session();\ntry {\n  await session.run('task');\n} finally {\n  await session[Symbol.asyncDispose]();\n}\n</code></pre>"},{"location":"getting-started/#next-steps","title":"Next Steps","text":"<ul> <li>Core Concepts - Deep dive into Agent, Session, Client, Tools, and Logging</li> <li>Examples - Working examples for common patterns</li> <li>Creating Tools - Build your own tools</li> <li>Code Execution - Different execution backends</li> </ul>"},{"location":"api/clients/chat-completions/","title":"ChatCompletionsClient API Reference","text":"<p>The <code>ChatCompletionsClient</code> provides OpenAI-compatible API support for chat completions.</p>"},{"location":"api/clients/chat-completions/#constructor","title":"Constructor","text":"<pre><code>new ChatCompletionsClient(config: ChatCompletionsClientConfig)\n</code></pre>"},{"location":"api/clients/chat-completions/#chatcompletionsclientconfig","title":"ChatCompletionsClientConfig","text":"<pre><code>interface ChatCompletionsClientConfig {\n  apiKey: string;\n  baseURL: string;\n  model: string;\n  maxTokens?: number;\n}\n</code></pre> Parameter Type Required Description <code>apiKey</code> <code>string</code> Yes API key for authentication <code>baseURL</code> <code>string</code> Yes Base URL for API endpoint <code>model</code> <code>string</code> Yes Model identifier <code>maxTokens</code> <code>number</code> No Maximum tokens in response"},{"location":"api/clients/chat-completions/#properties","title":"Properties","text":""},{"location":"api/clients/chat-completions/#name","title":"name","text":"<pre><code>readonly name: string\n</code></pre> <p>Client identifier (returns the model name).</p>"},{"location":"api/clients/chat-completions/#methods","title":"Methods","text":""},{"location":"api/clients/chat-completions/#complete","title":"complete()","text":"<pre><code>async complete(\n  messages: ChatMessage[],\n  tools: ToolDefinition[],\n  signal?: AbortSignal\n): Promise&lt;ChatCompletionResponse&gt;\n</code></pre> <p>Send a chat completion request.</p> <p>Parameters:</p> Parameter Type Description <code>messages</code> <code>ChatMessage[]</code> Conversation history <code>tools</code> <code>ToolDefinition[]</code> Available tools <code>signal</code> <code>AbortSignal</code> Optional cancellation signal <p>Returns:</p> <pre><code>interface ChatCompletionResponse {\n  message: ChatMessage;\n  tokenUsage?: {\n    input: number;\n    output: number;\n  };\n}\n</code></pre>"},{"location":"api/clients/chat-completions/#usage-examples","title":"Usage Examples","text":""},{"location":"api/clients/chat-completions/#openrouter","title":"OpenRouter","text":"<pre><code>import { ChatCompletionsClient } from 'stirrupjs/clients';\n\nconst client = new ChatCompletionsClient({\n  apiKey: process.env.OPENROUTER_API_KEY!,\n  baseURL: 'https://openrouter.ai/api/v1',\n  model: 'anthropic/claude-sonnet-4.5',\n  maxTokens: 100_000,\n});\n</code></pre>"},{"location":"api/clients/chat-completions/#openai","title":"OpenAI","text":"<pre><code>const client = new ChatCompletionsClient({\n  apiKey: process.env.OPENAI_API_KEY!,\n  baseURL: 'https://api.openai.com/v1',\n  model: 'gpt-5.2',\n  maxTokens: 8000,\n});\n</code></pre>"},{"location":"api/clients/chat-completions/#together-ai","title":"Together AI","text":"<pre><code>const client = new ChatCompletionsClient({\n  apiKey: process.env.TOGETHER_API_KEY!,\n  baseURL: 'https://api.together.xyz/v1',\n  model: 'meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo',\n  maxTokens: 8000,\n});\n</code></pre>"},{"location":"api/clients/chat-completions/#deepseek","title":"Deepseek","text":"<pre><code>const client = new ChatCompletionsClient({\n  apiKey: process.env.DEEPSEEK_API_KEY!,\n  baseURL: 'https://api.deepseek.com/v1',\n  model: 'deepseek-chat',\n  maxTokens: 4000,\n});\n</code></pre>"},{"location":"api/clients/chat-completions/#error-handling","title":"Error Handling","text":"<pre><code>try {\n  const response = await client.complete(messages, tools);\n} catch (error) {\n  if (error.name === 'AbortError') {\n    console.log('Request cancelled');\n  } else if (error.response?.status === 429) {\n    console.log('Rate limited');\n  } else {\n    console.error('API error:', error);\n  }\n}\n</code></pre>"},{"location":"api/clients/chat-completions/#see-also","title":"See Also","text":"<ul> <li>Custom Clients - Implement custom clients</li> <li>Core Concepts - Client overview</li> </ul>"},{"location":"api/core/agent/","title":"Agent API Reference","text":"<p>The <code>Agent</code> class orchestrates the agent loop: receiving user input, calling the LLM, executing tools, and returning results.</p>"},{"location":"api/core/agent/#constructor","title":"Constructor","text":"<pre><code>new Agent&lt;FP, FM&gt;(config: AgentConfig&lt;FP, FM&gt;)\n</code></pre>"},{"location":"api/core/agent/#agentconfig","title":"AgentConfig","text":"<pre><code>interface AgentConfig&lt;FP = unknown, FM = unknown&gt; {\n  client: Client;\n  name?: string;\n  maxTurns?: number;\n  tools?: Array&lt;BaseTool | ToolProvider&gt;;\n  finishTool?: Tool&lt;FP, FM&gt;;\n  systemPrompt?: string;\n  contextSummarizationCutoff?: number;\n  runSyncInThread?: boolean;\n  textOnlyToolResponses?: boolean;\n}\n</code></pre> Parameter Type Default Description <code>client</code> <code>Client</code> Required LLM client for completions <code>name</code> <code>string</code> <code>'agent'</code> Agent identifier <code>maxTurns</code> <code>number</code> <code>25</code> Maximum conversation turns <code>tools</code> <code>Array&lt;BaseTool \\| ToolProvider&gt;</code> <code>[]</code> Available tools <code>finishTool</code> <code>Tool&lt;FP, FM&gt;</code> - Tool to signal completion <code>systemPrompt</code> <code>string</code> - Initial system message <code>contextSummarizationCutoff</code> <code>number</code> <code>0.75</code> Context usage before summarization (0-1) <code>runSyncInThread</code> <code>boolean</code> <code>false</code> Run sync executors in worker threads <code>textOnlyToolResponses</code> <code>boolean</code> <code>false</code> Convert tool responses to text"},{"location":"api/core/agent/#methods","title":"Methods","text":""},{"location":"api/core/agent/#session","title":"session()","text":"<p>Create a session for managing tool lifecycle and files.</p> <pre><code>session(config?: SessionConfig): this\n</code></pre> <p>Parameters:</p> <pre><code>interface SessionConfig {\n  outputDir?: string;      // Default: './output'\n  inputFiles?: string | string[];  // Reserved for future use\n}\n</code></pre> <p>Returns: <code>this</code> (the agent instance, configured for disposal)</p> <p>Usage:</p> <pre><code>await using session = agent.session({ outputDir: './results' });\nconst result = await session.run('Create a chart');\n// Automatic cleanup on scope exit\n</code></pre>"},{"location":"api/core/agent/#run","title":"run()","text":"<p>Execute the agent with a task or initial messages.</p> <pre><code>async run(\n  initMessages: string | ChatMessage[],\n  options?: RunOptions\n): Promise&lt;AgentRunResult&lt;FP, FM&gt;&gt;\n</code></pre> <p>Parameters:</p> Parameter Type Description <code>initMessages</code> <code>string \\| ChatMessage[]</code> Initial task or conversation <code>options.signal</code> <code>AbortSignal</code> Optional cancellation signal <p>Returns:</p> <pre><code>interface AgentRunResult&lt;FP, FM = unknown&gt; {\n  finishParams?: FP;                // Finish tool parameters\n  messageHistory: ChatMessage[][];  // Conversation history (grouped)\n  runMetadata: Record&lt;string, unknown&gt;;  // Aggregated tool metadata\n}\n</code></pre> <p>Usage:</p> <pre><code>// Simple task\nconst result = await agent.run('What is 2 + 2?');\n\n// With cancellation\nconst controller = new AbortController();\nconst result = await agent.run('Long task', { signal: controller.signal });\n\n// With initial messages\nconst result = await agent.run([\n  { role: 'user', content: 'Hello!' },\n  { role: 'assistant', content: 'Hi! How can I help?' },\n  { role: 'user', content: 'Tell me about AI' },\n]);\n</code></pre>"},{"location":"api/core/agent/#runstream","title":"runStream()","text":"<p>Execute the agent and stream events.</p> <pre><code>runStream(\n  initMessages: string | ChatMessage[],\n  options?: RunOptions\n): AsyncGenerator&lt;AgentEvent&gt;\n</code></pre> <p>Returns: Async generator yielding events</p> <p>Event Types:</p> <pre><code>type AgentEvent =\n  | { type: 'start'; task: string | ChatMessage[] }\n  | { type: 'turn:start'; turn: number; maxTurns: number }\n  | { type: 'message'; message: ChatMessage }\n  | { type: 'tool:result'; toolName: string; success: boolean; result: string }\n  | { type: 'turn:complete'; tokenUsage?: TokenUsage }\n  | { type: 'summarization' }\n  | { type: 'complete'; result: AgentRunResult&lt;FP, FM&gt; }\n  | { type: 'error'; error: Error };\n</code></pre> <p>Usage:</p> <pre><code>for await (const event of agent.runStream('task')) {\n  switch (event.type) {\n    case 'start':\n      console.log('Started');\n      break;\n    case 'message':\n      console.log('Message:', event.message);\n      break;\n    case 'complete':\n      console.log('Done:', event.result);\n      break;\n  }\n}\n</code></pre>"},{"location":"api/core/agent/#totool","title":"toTool()","text":"<p>Convert agent to a tool for use as a sub-agent.</p> <pre><code>toTool(description?: string): Tool&lt;SubAgentParamsSchema, ToolUseCountMetadata&gt;\n</code></pre> <p>Parameters:</p> Parameter Type Description <code>description</code> <code>string</code> Tool description (defaults to agent's name) <p>Returns: Tool that delegates tasks to this agent</p> <p>Usage:</p> <pre><code>const researcher = new Agent({ client, name: 'researcher', tools: [webTools] });\nconst mathExpert = new Agent({ client, name: 'math', tools: [calcTools] });\n\nconst coordinator = new Agent({\n  client,\n  tools: [\n    researcher.toTool('Delegate research tasks'),\n    mathExpert.toTool('Delegate math problems'),\n  ],\n});\n</code></pre>"},{"location":"api/core/agent/#on","title":"on()","text":"<p>Register event listener.</p> <pre><code>on(event: string, handler: (data: any) =&gt; void): void\n</code></pre> <p>Events:</p> Event Data Description <code>run:start</code> <code>{ task }</code> Agent run started <code>turn:start</code> <code>{ turn, maxTurns }</code> Turn started <code>message:assistant</code> <code>{ content, toolCalls }</code> Assistant message <code>message:tool</code> <code>{ name, result }</code> Tool result <code>tool:start</code> <code>{ name }</code> Tool execution started <code>tool:complete</code> <code>{ name, success }</code> Tool execution completed <code>tool:error</code> <code>{ name, error }</code> Tool execution failed <code>turn:complete</code> <code>{ tokenUsage }</code> Turn completed <code>run:complete</code> <code>{ result, duration }</code> Run completed successfully <code>run:error</code> <code>{ error, duration }</code> Run failed <p>Usage:</p> <pre><code>agent.on('turn:start', ({ turn, maxTurns }) =&gt; {\n  console.log(`Turn ${turn + 1}/${maxTurns}`);\n});\n\nagent.on('tool:complete', ({ name, success }) =&gt; {\n  console.log(`${name}: ${success ? 'success' : 'failure'}`);\n});\n</code></pre>"},{"location":"api/core/agent/#symbolasyncdispose","title":"Symbol.asyncDispose()","text":"<p>Cleanup agent resources.</p> <pre><code>async [Symbol.asyncDispose](): Promise&lt;void&gt;\n</code></pre> <p>Usage:</p> <pre><code>// Automatic with 'await using'\nawait using session = agent.session();\n\n// Manual\nconst session = agent.session();\ntry {\n  await session.run('task');\n} finally {\n  await session[Symbol.asyncDispose]();\n}\n</code></pre>"},{"location":"api/core/agent/#types","title":"Types","text":""},{"location":"api/core/agent/#chatmessage","title":"ChatMessage","text":"<pre><code>interface ChatMessage {\n  role: 'system' | 'user' | 'assistant' | 'tool';\n  content: string | ContentBlock[];\n  tool_calls?: ToolCall[];\n  tool_call_id?: string;\n}\n</code></pre>"},{"location":"api/core/agent/#contentblock","title":"ContentBlock","text":"<pre><code>type ContentBlock = TextContentBlock | ImageContentBlock;\n\ninterface TextContentBlock {\n  type: 'text';\n  text: string;\n}\n\ninterface ImageContentBlock {\n  type: 'image';\n  source: {\n    type: 'base64' | 'url';\n    media_type: string;\n    data: string;\n  };\n}\n</code></pre>"},{"location":"api/core/agent/#toolcall","title":"ToolCall","text":"<pre><code>interface ToolCall {\n  id: string;\n  type: 'function';\n  function: {\n    name: string;\n    arguments: string;  // JSON string\n  };\n}\n</code></pre>"},{"location":"api/core/agent/#tokenusage","title":"TokenUsage","text":"<pre><code>interface TokenUsage {\n  input: number;\n  output: number;\n}\n</code></pre>"},{"location":"api/core/agent/#examples","title":"Examples","text":""},{"location":"api/core/agent/#basic-agent","title":"Basic Agent","text":"<pre><code>import { Agent, SIMPLE_FINISH_TOOL, DEFAULT_TOOLS } from 'stirrupjs';\nimport { ChatCompletionsClient } from 'stirrupjs/clients';\n\nconst client = new ChatCompletionsClient({\n  apiKey: process.env.OPENROUTER_API_KEY!,\n  baseURL: 'https://openrouter.ai/api/v1',\n  model: 'anthropic/claude-sonnet-4.5',\n});\n\nconst agent = new Agent({\n  client,\n  name: 'assistant',\n  maxTurns: 10,\n  tools: DEFAULT_TOOLS,\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n\nawait using session = agent.session();\nconst result = await session.run('What is 2 + 2?');\n</code></pre>"},{"location":"api/core/agent/#with-event-monitoring","title":"With Event Monitoring","text":"<pre><code>const agent = new Agent({ client, tools: DEFAULT_TOOLS });\n\nagent.on('turn:start', ({ turn }) =&gt; console.log(`Turn ${turn}`));\nagent.on('tool:complete', ({ name }) =&gt; console.log(`Tool: ${name}`));\n\nawait using session = agent.session();\nawait session.run('task');\n</code></pre>"},{"location":"api/core/agent/#with-cancellation","title":"With Cancellation","text":"<pre><code>const controller = new AbortController();\nsetTimeout(() =&gt; controller.abort(), 30000);\n\nawait using session = agent.session();\ntry {\n  await session.run('long task', { signal: controller.signal });\n} catch (error) {\n  if (error.name === 'AbortError') {\n    console.log('Cancelled');\n  }\n}\n</code></pre>"},{"location":"api/core/agent/#see-also","title":"See Also","text":"<ul> <li>Core Concepts - Understanding agents</li> <li>Examples - Working examples</li> <li>Client API - LLM client reference</li> </ul>"},{"location":"api/tools/","title":"Tools API Reference","text":"<p>Overview of the tools API and built-in tools.</p>"},{"location":"api/tools/#interfaces","title":"Interfaces","text":""},{"location":"api/tools/#tool","title":"Tool","text":"<pre><code>interface Tool&lt;P extends z.ZodType, M = unknown&gt; {\n  name: string;\n  description: string;\n  parameters: P;\n  executor: (params: z.infer&lt;P&gt;) =&gt; Promise&lt;ToolResult&lt;M&gt;&gt; | ToolResult&lt;M&gt;;\n}\n</code></pre>"},{"location":"api/tools/#toolprovider","title":"ToolProvider","text":"<pre><code>interface ToolProvider {\n  name: string;\n  initialize?(): Promise&lt;void&gt;;\n  getTools(): BaseTool[];\n  dispose?(): Promise&lt;void&gt;;\n}\n</code></pre>"},{"location":"api/tools/#toolresult","title":"ToolResult","text":"<pre><code>interface ToolResult&lt;M = unknown&gt; {\n  content: string | ContentBlock[];\n  metadata?: M;\n}\n</code></pre>"},{"location":"api/tools/#built-in-tools","title":"Built-in Tools","text":""},{"location":"api/tools/#simple_finish_tool","title":"SIMPLE_FINISH_TOOL","text":"<p>Signal task completion:</p> <pre><code>import { SIMPLE_FINISH_TOOL, type FinishParams } from 'stirrupjs';\n\n// Schema\ninterface FinishParams {\n  reason: string;      // Summary of what was done\n  paths: string[];     // Output file paths\n}\n\n// Usage\nconst agent = new Agent({\n  client,\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre>"},{"location":"api/tools/#calculator_tool","title":"CALCULATOR_TOOL","text":"<p>Perform calculations:</p> <pre><code>import { CALCULATOR_TOOL } from 'stirrupjs';\n\n// Schema\ninterface CalculatorParams {\n  expression: string;  // Math expression to evaluate\n}\n\n// Usage\nconst agent = new Agent({\n  client,\n  tools: [CALCULATOR_TOOL],\n});\n</code></pre>"},{"location":"api/tools/#default_tools","title":"DEFAULT_TOOLS","text":"<p>Standard tool set (code execution + web):</p> <pre><code>import { DEFAULT_TOOLS } from 'stirrupjs';\n\n// Includes:\n// - LocalCodeExecToolProvider\n// - WebToolProvider\n\nconst agent = new Agent({\n  client,\n  tools: DEFAULT_TOOLS,\n});\n</code></pre>"},{"location":"api/tools/#metadata-classes","title":"Metadata Classes","text":""},{"location":"api/tools/#toolusecountmetadata","title":"ToolUseCountMetadata","text":"<pre><code>class ToolUseCountMetadata {\n  numUses: number;\n\n  constructor(count: number = 1);\n  merge(other: ToolUseCountMetadata): ToolUseCountMetadata;\n}\n</code></pre>"},{"location":"api/tools/#webfetchmetadata","title":"WebFetchMetadata","text":"<pre><code>class WebFetchMetadata {\n  numFetches: number;\n  totalBytes: number;\n\n  merge(other: WebFetchMetadata): WebFetchMetadata;\n}\n</code></pre>"},{"location":"api/tools/#websearchmetadata","title":"WebSearchMetadata","text":"<pre><code>class WebSearchMetadata {\n  numSearches: number;\n  numResults: number;\n\n  merge(other: WebSearchMetadata): WebSearchMetadata;\n}\n</code></pre>"},{"location":"api/tools/#see-also","title":"See Also","text":"<ul> <li>Creating Tools - Build custom tools</li> <li>Tool Providers - Manage tool lifecycle</li> <li>Web Tools - Web fetch and search</li> <li>Code Execution - Code execution tools</li> </ul>"},{"location":"extending/full-customization/","title":"Full Customization","text":"<p>For deep customization of the framework internals, you can clone the StirrupJS repository and modify the source code directly.</p>"},{"location":"extending/full-customization/#when-to-customize","title":"When to Customize","text":"<p>Consider full customization when you need to:</p> <ul> <li>Modify core agent behavior (loop logic, context management)</li> <li>Change how tools are executed or validated</li> <li>Implement custom message formats or protocols</li> <li>Integrate with proprietary infrastructure</li> <li>Build a specialized framework on top of StirrupJS</li> </ul> <p>For most use cases, you don't need full customization: - Custom tools: Use the Tools guide - Custom clients: Use the Clients guide - Custom loggers: Use the Loggers guide</p>"},{"location":"extending/full-customization/#getting-started","title":"Getting Started","text":""},{"location":"extending/full-customization/#1-clone-the-repository","title":"1. Clone the Repository","text":"<pre><code>git clone https://github.com/ArtificialAnalysis/stirrup-js.git\ncd stirrup-js\n</code></pre>"},{"location":"extending/full-customization/#2-install-dependencies","title":"2. Install Dependencies","text":"<pre><code>npm install\n</code></pre>"},{"location":"extending/full-customization/#3-build-the-project","title":"3. Build the Project","text":"<pre><code>npm run build\n</code></pre> <p>This compiles TypeScript to JavaScript in the <code>dist/</code> directory.</p>"},{"location":"extending/full-customization/#4-run-examples","title":"4. Run Examples","text":"<pre><code># Set up environment\ncp .env.example .env\n# Edit .env with your API keys\n\n# Run an example\nnpx tsx examples/getting-started.ts\n</code></pre>"},{"location":"extending/full-customization/#project-structure","title":"Project Structure","text":"<pre><code>stirrup-js/\n\u251c\u2500\u2500 src/                    # Source code\n\u2502   \u251c\u2500\u2500 core/              # Core agent logic\n\u2502   \u2502   \u251c\u2500\u2500 agent.ts       # Agent class\n\u2502   \u2502   \u251c\u2500\u2500 session.ts     # Session management\n\u2502   \u2502   \u2514\u2500\u2500 context.ts     # Context tracking\n\u2502   \u251c\u2500\u2500 clients/           # LLM clients\n\u2502   \u2502   \u2514\u2500\u2500 openai-client.ts\n\u2502   \u251c\u2500\u2500 tools/             # Built-in tools\n\u2502   \u2502   \u251c\u2500\u2500 code-exec/     # Code execution\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 base.ts\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 local.ts\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 docker.ts\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 e2b.ts\n\u2502   \u2502   \u251c\u2500\u2500 web/           # Web tools\n\u2502   \u2502   \u251c\u2500\u2500 finish.ts      # Finish tool\n\u2502   \u2502   \u2514\u2500\u2500 calculator.ts  # Calculator tool\n\u2502   \u251c\u2500\u2500 utils/             # Utilities\n\u2502   \u2502   \u251c\u2500\u2500 logger.ts      # Logging\n\u2502   \u2502   \u2514\u2500\u2500 structured-logger.ts\n\u2502   \u2514\u2500\u2500 index.ts           # Main exports\n\u251c\u2500\u2500 examples/              # Example code\n\u251c\u2500\u2500 docs/                  # Documentation\n\u251c\u2500\u2500 dist/                  # Compiled output\n\u2514\u2500\u2500 package.json\n</code></pre>"},{"location":"extending/full-customization/#key-files-to-customize","title":"Key Files to Customize","text":""},{"location":"extending/full-customization/#core-agent-logic","title":"Core Agent Logic","text":"<p><code>src/core/agent.ts</code> - Main agent loop - Tool execution - Message handling - Context management</p> <p>Example customization:</p> <pre><code>// Add custom pre-processing before each turn\nasync processTurn() {\n  // Your custom logic here\n  await this.myCustomPreprocessing();\n\n  // Original turn logic\n  const response = await this.client.complete(/* ... */);\n\n  // Your custom post-processing\n  await this.myCustomPostprocessing(response);\n\n  return response;\n}\n</code></pre>"},{"location":"extending/full-customization/#session-management","title":"Session Management","text":"<p><code>src/core/session.ts</code> - Session context - File handling - Tool initialization</p> <p>Example customization:</p> <pre><code>// Add custom session initialization\nexport async function createSessionState(agent: Agent): Promise&lt;SessionState&gt; {\n  const state = {\n    // Original state\n    depth: getParentDepth(),\n    execEnv: null,\n\n    // Your custom additions\n    customMetrics: new MyMetrics(),\n    auditLog: new AuditLogger(),\n  };\n\n  return state;\n}\n</code></pre>"},{"location":"extending/full-customization/#tool-execution","title":"Tool Execution","text":"<p><code>src/core/agent.ts</code> - <code>executeTool()</code> - How tools are called - Parameter validation - Result handling</p> <p>Example customization:</p> <pre><code>async executeTool(toolCall: ToolCall) {\n  // Add rate limiting\n  await this.rateLimiter.checkLimit(toolCall.function.name);\n\n  // Add logging\n  this.auditLog.logToolCall(toolCall);\n\n  // Original execution\n  const result = await super.executeTool(toolCall);\n\n  // Add custom result processing\n  return this.processToolResult(result);\n}\n</code></pre>"},{"location":"extending/full-customization/#common-customizations","title":"Common Customizations","text":""},{"location":"extending/full-customization/#1-custom-message-format","title":"1. Custom Message Format","text":"<p>Modify how messages are structured:</p> <pre><code>// src/core/agent.ts\ninterface CustomChatMessage extends ChatMessage {\n  metadata?: {\n    timestamp: number;\n    userId?: string;\n    sessionId?: string;\n  };\n}\n\nclass CustomAgent extends Agent {\n  protected async addMessage(message: ChatMessage) {\n    const customMessage: CustomChatMessage = {\n      ...message,\n      metadata: {\n        timestamp: Date.now(),\n        userId: this.currentUserId,\n        sessionId: this.sessionId,\n      },\n    };\n\n    this.messages.push(customMessage);\n  }\n}\n</code></pre>"},{"location":"extending/full-customization/#2-custom-context-summarization","title":"2. Custom Context Summarization","text":"<p>Implement your own summarization strategy:</p> <pre><code>// src/core/agent.ts\nclass CustomAgent extends Agent {\n  protected async shouldSummarize(): Promise&lt;boolean&gt; {\n    // Your custom logic\n    const tokenCount = this.estimateTokens();\n    const turnCount = this.messageHistory.length;\n\n    // Summarize based on custom criteria\n    return tokenCount &gt; 50000 || turnCount &gt; 20;\n  }\n\n  protected async summarizeContext() {\n    // Your custom summarization\n    const summary = await this.myCustomSummarizer(this.messages);\n    this.messages = [summary, ...this.recentMessages];\n  }\n}\n</code></pre>"},{"location":"extending/full-customization/#3-tool-result-caching","title":"3. Tool Result Caching","text":"<p>Cache tool results to avoid redundant execution:</p> <pre><code>// src/core/agent.ts\nclass CachingAgent extends Agent {\n  private cache = new Map&lt;string, ToolResult&gt;();\n\n  protected async executeTool(toolCall: ToolCall): Promise&lt;ToolResult&gt; {\n    const cacheKey = this.getCacheKey(toolCall);\n\n    if (this.cache.has(cacheKey)) {\n      console.log('Cache hit:', toolCall.function.name);\n      return this.cache.get(cacheKey)!;\n    }\n\n    const result = await super.executeTool(toolCall);\n    this.cache.set(cacheKey, result);\n\n    return result;\n  }\n\n  private getCacheKey(toolCall: ToolCall): string {\n    return `${toolCall.function.name}:${toolCall.function.arguments}`;\n  }\n}\n</code></pre>"},{"location":"extending/full-customization/#4-custom-retry-logic","title":"4. Custom Retry Logic","text":"<p>Add retry logic for failed tool calls:</p> <pre><code>// src/core/agent.ts\nclass RetryAgent extends Agent {\n  protected async executeTool(\n    toolCall: ToolCall,\n    maxRetries = 3\n  ): Promise&lt;ToolResult&gt; {\n    let lastError: Error | undefined;\n\n    for (let attempt = 1; attempt &lt;= maxRetries; attempt++) {\n      try {\n        return await super.executeTool(toolCall);\n      } catch (error) {\n        lastError = error as Error;\n        console.log(`Attempt ${attempt} failed:`, error);\n\n        if (attempt &lt; maxRetries) {\n          await this.delay(1000 * attempt); // Exponential backoff\n        }\n      }\n    }\n\n    throw lastError;\n  }\n\n  private delay(ms: number): Promise&lt;void&gt; {\n    return new Promise(resolve =&gt; setTimeout(resolve, ms));\n  }\n}\n</code></pre>"},{"location":"extending/full-customization/#5-telemetry-and-monitoring","title":"5. Telemetry and Monitoring","text":"<p>Add comprehensive telemetry:</p> <pre><code>// src/core/agent.ts\nclass MonitoredAgent extends Agent {\n  private metrics = {\n    totalTurns: 0,\n    toolCalls: new Map&lt;string, number&gt;(),\n    errors: new Map&lt;string, number&gt;(),\n    avgTurnDuration: 0,\n  };\n\n  protected async processTurn() {\n    const startTime = Date.now();\n    this.metrics.totalTurns++;\n\n    try {\n      const result = await super.processTurn();\n\n      // Track successful turn\n      const duration = Date.now() - startTime;\n      this.updateAvgDuration(duration);\n\n      return result;\n    } catch (error) {\n      // Track errors\n      const errorType = error.constructor.name;\n      this.metrics.errors.set(\n        errorType,\n        (this.metrics.errors.get(errorType) || 0) + 1\n      );\n\n      throw error;\n    }\n  }\n\n  getMetrics() {\n    return this.metrics;\n  }\n}\n</code></pre>"},{"location":"extending/full-customization/#using-custom-code","title":"Using Custom Code","text":""},{"location":"extending/full-customization/#option-1-modify-and-use-locally","title":"Option 1: Modify and Use Locally","text":"<pre><code>// Your application code\nimport { Agent } from './stirrup-js/src/core/agent.js';\nimport { ChatCompletionsClient } from './stirrup-js/src/clients/openai-client.js';\n\nconst agent = new Agent({\n  client,\n  // Your config\n});\n</code></pre>"},{"location":"extending/full-customization/#option-2-build-and-install-locally","title":"Option 2: Build and Install Locally","text":"<pre><code># In stirrup-js directory\nnpm run build\nnpm link\n\n# In your project\nnpm link stirrupjs\n</code></pre>"},{"location":"extending/full-customization/#option-3-publish-private-package","title":"Option 3: Publish Private Package","text":"<pre><code># Update package.json name\n{\n  \"name\": \"@myorg/stirrupjs\",\n  \"version\": \"1.0.0\"\n}\n\n# Publish to private registry\nnpm publish --registry https://your-registry.com\n</code></pre>"},{"location":"extending/full-customization/#testing-custom-changes","title":"Testing Custom Changes","text":""},{"location":"extending/full-customization/#run-existing-tests","title":"Run Existing Tests","text":"<pre><code>npm test\n</code></pre>"},{"location":"extending/full-customization/#add-your-own-tests","title":"Add Your Own Tests","text":"<pre><code>// tests/custom-agent.test.ts\nimport { describe, it, expect } from 'vitest';\nimport { CustomAgent } from '../src/core/custom-agent';\n\ndescribe('CustomAgent', () =&gt; {\n  it('should implement custom behavior', async () =&gt; {\n    const agent = new CustomAgent({ /* ... */ });\n    // Your tests\n  });\n});\n</code></pre>"},{"location":"extending/full-customization/#contributing-back","title":"Contributing Back","text":"<p>If your customization would benefit others, consider contributing:</p> <ol> <li>Fork the repository</li> <li>Create a feature branch</li> <li>Make your changes</li> <li>Add tests</li> <li>Submit a pull request</li> </ol> <p>See <code>CONTRIBUTING.md</code> in the repository.</p>"},{"location":"extending/full-customization/#examples-in-the-wild","title":"Examples in the Wild","text":"<p>Check out these projects using StirrupJS:</p> <ul> <li>StirrupJS - The main repository</li> <li>Stirrup - Python version</li> </ul>"},{"location":"extending/full-customization/#best-practices","title":"Best Practices","text":"<ol> <li>Extend, don't modify: Use class extension when possible</li> <li>Keep it compatible: Maintain public API compatibility</li> <li>Document changes: Comment your customizations</li> <li>Test thoroughly: Write tests for custom behavior</li> <li>Version control: Track your modifications separately</li> <li>Stay updated: Regularly sync with upstream</li> </ol>"},{"location":"extending/full-customization/#getting-help","title":"Getting Help","text":"<ul> <li>GitHub Issues: Report bugs or request features</li> <li>Discussions: Ask questions and share customizations</li> <li>Documentation: Check the guides and API reference</li> </ul>"},{"location":"extending/full-customization/#next-steps","title":"Next Steps","text":"<ul> <li>Custom Clients - Implement custom LLM clients</li> <li>Custom Tools - Advanced tool patterns</li> <li>Custom Loggers - Implement custom logging</li> </ul>"},{"location":"guides/code-execution/","title":"Code Execution","text":"<p>StirrupJS includes three code execution backends: local, Docker, and E2B cloud sandboxes. All backends provide the same <code>code_exec</code> tool interface.</p>"},{"location":"guides/code-execution/#overview","title":"Overview","text":"<p>The <code>code_exec</code> tool allows agents to execute shell commands in an isolated environment. This is one of the most powerful built-in tools.</p> <p>Common use cases: - Installing and using Python packages - Data analysis and visualization - File processing and conversion - Running scripts and automation - Image and video manipulation</p>"},{"location":"guides/code-execution/#local-execution-default","title":"Local Execution (Default)","text":"<p>The <code>LocalCodeExecToolProvider</code> executes commands in a temporary directory on your machine.</p>"},{"location":"guides/code-execution/#basic-usage","title":"Basic Usage","text":"<pre><code>import { LocalCodeExecToolProvider } from 'stirrupjs/tools';\n\nconst agent = new Agent({\n  client,\n  tools: [new LocalCodeExecToolProvider()],\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre> <p>Or use <code>DEFAULT_TOOLS</code> which includes local execution:</p> <pre><code>import { DEFAULT_TOOLS } from 'stirrupjs';\n\nconst agent = new Agent({\n  client,\n  tools: DEFAULT_TOOLS,  // Includes LocalCodeExecToolProvider\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre>"},{"location":"guides/code-execution/#features","title":"Features","text":"<ul> <li>Isolated temp directory: Each session gets a fresh temp directory</li> <li>Security: Commands run with current user permissions</li> <li>uv package manager: Recommended for Python packages (fast, reliable)</li> <li>File access: Read/write files in execution directory</li> <li>Output capture: Returns stdout, stderr, and exit code</li> </ul>"},{"location":"guides/code-execution/#example","title":"Example","text":"<pre><code>await using session = agent.session({ outputDir: './output' });\n\nawait session.run(`\n  Create a Python script that generates a sine wave chart:\n  1. Use matplotlib to create the chart\n  2. Save as sine_wave.png\n  3. Call finish with the file path\n`);\n\n// File automatically saved to ./output/sine_wave.png\n</code></pre>"},{"location":"guides/code-execution/#command-restrictions","title":"Command Restrictions","text":"<p>You can restrict which commands are allowed:</p> <pre><code>const provider = new LocalCodeExecToolProvider([\n  'python',\n  'node',\n  'uv',\n  'pip',\n]);\n</code></pre>"},{"location":"guides/code-execution/#custom-temp-directory","title":"Custom Temp Directory","text":"<pre><code>const provider = new LocalCodeExecToolProvider(\n  undefined,  // No command restrictions\n  '/custom/temp/path'\n);\n</code></pre>"},{"location":"guides/code-execution/#docker-execution","title":"Docker Execution","text":"<p>The <code>DockerCodeExecToolProvider</code> runs commands in Docker containers for better isolation.</p>"},{"location":"guides/code-execution/#installation","title":"Installation","text":"<p>Requires Docker to be installed and running on your machine.</p>"},{"location":"guides/code-execution/#basic-usage_1","title":"Basic Usage","text":"<pre><code>import { DockerCodeExecToolProvider } from 'stirrupjs/tools';\n\nconst agent = new Agent({\n  client,\n  tools: [new DockerCodeExecToolProvider('python:3.12-slim')],\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre>"},{"location":"guides/code-execution/#configuration","title":"Configuration","text":"<pre><code>const provider = new DockerCodeExecToolProvider(\n  'python:3.12-slim',  // Docker image\n  undefined,           // Allowed commands (undefined = all)\n  undefined,           // Temp directory base path\n  'Docker code execution'  // Custom description\n);\n</code></pre>"},{"location":"guides/code-execution/#features_1","title":"Features","text":"<ul> <li>Full isolation: Commands run in containers</li> <li>Consistent environment: Same environment every time</li> <li>Security: Better isolation than local execution</li> <li>Custom images: Use any Docker image</li> <li>File access: Files automatically mounted</li> </ul>"},{"location":"guides/code-execution/#example-images","title":"Example Images","text":"<pre><code>// Python with scientific packages\nnew DockerCodeExecToolProvider('python:3.12-slim')\n\n// Node.js\nnew DockerCodeExecToolProvider('node:20-alpine')\n\n// Custom image with dependencies\nnew DockerCodeExecToolProvider('myorg/custom-agent-env:latest')\n</code></pre>"},{"location":"guides/code-execution/#limitations","title":"Limitations","text":"<ul> <li>Slower startup (container creation)</li> <li>Requires Docker installed</li> <li>More resource intensive</li> </ul>"},{"location":"guides/code-execution/#e2b-cloud-sandboxes","title":"E2B Cloud Sandboxes","text":"<p>The <code>E2BCodeExecToolProvider</code> runs commands in E2B cloud sandboxes - fully isolated, cloud-based environments.</p>"},{"location":"guides/code-execution/#installation_1","title":"Installation","text":"<p>Sign up for E2B: https://e2b.dev</p> <p>Set your API key: <pre><code>export E2B_API_KEY='your-key-here'\n</code></pre></p>"},{"location":"guides/code-execution/#basic-usage_2","title":"Basic Usage","text":"<pre><code>import { E2BCodeExecToolProvider } from 'stirrupjs/tools';\n\nconst agent = new Agent({\n  client,\n  tools: [new E2BCodeExecToolProvider({\n    apiKey: process.env.E2B_API_KEY!,\n    template: 'base',\n  })],\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre>"},{"location":"guides/code-execution/#configuration_1","title":"Configuration","text":"<pre><code>const provider = new E2BCodeExecToolProvider({\n  apiKey: process.env.E2B_API_KEY!,\n  template: 'base',           // E2B template\n  metadata: { user: 'alice' }, // Optional metadata\n  timeoutMs: 60000,           // Execution timeout\n});\n</code></pre>"},{"location":"guides/code-execution/#features_2","title":"Features","text":"<ul> <li>Cloud-based: No local setup required</li> <li>Scalable: Automatic resource management</li> <li>Secure: Complete isolation in cloud</li> <li>Fast: Pre-warmed environments</li> <li>Consistent: Same environment everywhere</li> </ul>"},{"location":"guides/code-execution/#templates","title":"Templates","text":"<p>E2B provides pre-built templates:</p> <ul> <li><code>base</code>: Basic Ubuntu environment</li> <li><code>python</code>: Python with common packages</li> <li><code>node</code>: Node.js environment</li> <li>Custom: Create your own templates</li> </ul> <p>See E2B templates for details.</p>"},{"location":"guides/code-execution/#advantages","title":"Advantages","text":"<ul> <li>No Docker installation needed</li> <li>Better for production deployments</li> <li>Scales automatically</li> <li>Consistent across development/production</li> </ul>"},{"location":"guides/code-execution/#limitations_1","title":"Limitations","text":"<ul> <li>Requires internet connection</li> <li>Costs money (has free tier)</li> <li>Slightly higher latency than local</li> </ul>"},{"location":"guides/code-execution/#choosing-a-backend","title":"Choosing a Backend","text":"Backend Best For Pros Cons Local Development, prototyping Fast, free, simple setup Less isolation, requires local environment Docker Production, better isolation Good isolation, consistent env Slower startup, needs Docker E2B Production, scale Cloud-based, secure, scalable Costs money, needs internet"},{"location":"guides/code-execution/#recommendations","title":"Recommendations","text":"<ul> <li>Development: Use <code>LocalCodeExecToolProvider</code> (fastest iteration)</li> <li>Production (self-hosted): Use <code>DockerCodeExecToolProvider</code> (better isolation)</li> <li>Production (cloud): Use <code>E2BCodeExecToolProvider</code> (easiest deployment)</li> </ul>"},{"location":"guides/code-execution/#using-python-packages","title":"Using Python Packages","text":"<p>All backends support package installation. We recommend using <code>uv</code> for fast, reliable package management.</p>"},{"location":"guides/code-execution/#example-task","title":"Example Task","text":"<pre><code>await session.run(`\n  Create a data visualization:\n  1. Use 'uv pip install matplotlib pandas'\n  2. Load data from data.csv\n  3. Create a bar chart\n  4. Save as chart.png\n  5. Call finish with the file path\n`);\n</code></pre>"},{"location":"guides/code-execution/#package-installation-with-uv","title":"Package Installation with uv","text":"<pre><code>// Agent automatically uses uv\nawait session.run(`\n  Install pandas and analyze data.csv:\n  1. Run: uv pip install pandas\n  2. Load the CSV\n  3. Calculate statistics\n  4. Print results\n`);\n</code></pre>"},{"location":"guides/code-execution/#traditional-pip","title":"Traditional pip","text":"<pre><code>await session.run(`\n  Use traditional pip if needed:\n  1. Run: pip install requests\n  2. Fetch data from API\n  3. Process and save\n`);\n</code></pre>"},{"location":"guides/code-execution/#working-with-files","title":"Working with Files","text":""},{"location":"guides/code-execution/#creating-files","title":"Creating Files","text":"<p>The agent can create files in its execution directory:</p> <pre><code>await using session = agent.session({ outputDir: './results' });\n\nawait session.run(`\n  Create three files:\n  1. data.json - some JSON data\n  2. chart.png - a visualization\n  3. report.txt - a summary\n\n  Call finish with all three file paths.\n`);\n\n// All three files saved to ./results/\n</code></pre>"},{"location":"guides/code-execution/#reading-files","title":"Reading Files","text":"<p>Files in the execution directory can be read:</p> <pre><code>await session.run(`\n  Read the file 'input.txt' and count words.\n  The file should be in the current directory.\n`);\n</code></pre>"},{"location":"guides/code-execution/#file-persistence","title":"File Persistence","text":"<p>Files persist within a session:</p> <pre><code>await session.run('Create data.csv with sample data');\nawait session.run('Load data.csv and create a chart');\n// data.csv is still available\n</code></pre> <p>But are cleaned up when session ends:</p> <pre><code>await using session = agent.session();\nawait session.run('Create temp.txt');\n// Session ends, temp.txt is deleted\n</code></pre>"},{"location":"guides/code-execution/#security-considerations","title":"Security Considerations","text":""},{"location":"guides/code-execution/#local-execution","title":"Local Execution","text":"<ul> <li>Commands run with your user permissions</li> <li>Can access files on your system</li> <li>Use <code>allowedCommands</code> to restrict execution</li> <li>Consider using Docker for untrusted code</li> </ul>"},{"location":"guides/code-execution/#docker-execution_1","title":"Docker Execution","text":"<ul> <li>Commands isolated in containers</li> <li>Cannot access host filesystem (except mounted volumes)</li> <li>Better for running untrusted code</li> <li>Still requires Docker daemon access</li> </ul>"},{"location":"guides/code-execution/#e2b-execution","title":"E2B Execution","text":"<ul> <li>Full isolation in cloud sandboxes</li> <li>Cannot access local system</li> <li>Best security for untrusted code</li> <li>Network access can be restricted</li> </ul>"},{"location":"guides/code-execution/#best-practices","title":"Best Practices","text":"<ol> <li>Validate user input: Never pass unsanitized user input directly to commands</li> <li>Restrict commands: Use <code>allowedCommands</code> in local/Docker</li> <li>Use Docker/E2B: For production or untrusted code</li> <li>Monitor execution: Use structured logging to track commands</li> <li>Set timeouts: Prevent infinite loops/long-running commands</li> </ol>"},{"location":"guides/code-execution/#advanced-usage","title":"Advanced Usage","text":""},{"location":"guides/code-execution/#custom-command-restrictions","title":"Custom Command Restrictions","text":"<pre><code>const provider = new LocalCodeExecToolProvider([\n  'python',    // Allow Python\n  'python3',   // And Python3\n  'uv',        // And uv\n  'node',      // And Node.js\n  // Block everything else (bash, rm, etc.)\n]);\n</code></pre>"},{"location":"guides/code-execution/#custom-description","title":"Custom Description","text":"<p>Help the agent understand the environment:</p> <pre><code>const provider = new LocalCodeExecToolProvider(\n  undefined,\n  undefined,\n  'Execute commands in a Python 3.12 environment with numpy, pandas, and matplotlib pre-installed. Use uv for package management.'\n);\n</code></pre>"},{"location":"guides/code-execution/#multiple-execution-environments","title":"Multiple Execution Environments","text":"<pre><code>const pythonEnv = new DockerCodeExecToolProvider('python:3.12');\nconst nodeEnv = new DockerCodeExecToolProvider('node:20');\n\nconst agent = new Agent({\n  client,\n  tools: [pythonEnv, nodeEnv],  // Error: Only one code exec provider allowed\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre> <p>One Code Exec Provider</p> <p>Agents can only have one code execution provider. Use Docker/E2B with pre-installed tools if you need multiple languages.</p>"},{"location":"guides/code-execution/#examples","title":"Examples","text":""},{"location":"guides/code-execution/#data-analysis","title":"Data Analysis","text":"<pre><code>await session.run(`\n  Analyze sales_data.csv:\n  1. Install pandas: uv pip install pandas\n  2. Load the CSV\n  3. Calculate total sales, average, and top 5 products\n  4. Print results in a formatted table\n`);\n</code></pre>"},{"location":"guides/code-execution/#image-processing","title":"Image Processing","text":"<pre><code>await session.run(`\n  Process image.jpg:\n  1. Install Pillow: uv pip install Pillow\n  2. Resize to 800x600\n  3. Apply blur filter\n  4. Save as processed.jpg\n  5. Call finish with the path\n`);\n</code></pre>"},{"location":"guides/code-execution/#web-scraping","title":"Web Scraping","text":"<pre><code>await session.run(`\n  Scrape data from example.com:\n  1. Install beautifulsoup4 requests: uv pip install beautifulsoup4 requests\n  2. Fetch the page\n  3. Extract all article titles\n  4. Save to titles.json\n  5. Call finish with the path\n`);\n</code></pre>"},{"location":"guides/code-execution/#next-steps","title":"Next Steps","text":"<ul> <li>Creating Tools - Build custom tools</li> <li>Tool Providers - Advanced tool management</li> <li>Examples - More code execution examples</li> </ul>"},{"location":"guides/skills/","title":"Skills","text":"<p>Skills are modular packages that extend agent capabilities with domain-specific instructions, scripts, and resources. They provide a structured way to give agents expertise in specific areas (e.g. data analysis, report writing).</p> <p>Learn more at agentskills.io.</p>"},{"location":"guides/skills/#overview","title":"Overview","text":"<p>A skill is a directory containing:</p> <ul> <li><code>SKILL.md</code>: Main instruction file with YAML frontmatter (<code>name</code>, <code>description</code>) and detailed guidance</li> <li><code>reference/</code> (optional): Reference documentation split into focused markdown files</li> <li><code>scripts/</code> (optional): Ready-to-use scripts the agent can run in the code execution environment</li> </ul> <p>When skills are loaded, the agent receives:</p> <ol> <li>A list of available skills in the system prompt</li> <li>Access to skill files in the execution environment (uploaded under <code>skills/</code>)</li> <li>Instructions on how to read and use the skills (<code>cat skills/&lt;skill&gt;/SKILL.md</code>)</li> </ol>"},{"location":"guides/skills/#quick-start","title":"Quick Start","text":""},{"location":"guides/skills/#1-create-a-skills-directory","title":"1. Create a Skills Directory","text":"<pre><code>skills/\n\u2514\u2500\u2500 data_analysis/\n    \u251c\u2500\u2500 SKILL.md\n    \u251c\u2500\u2500 reference/\n    \u2502   \u251c\u2500\u2500 loading.md\n    \u2502   \u2514\u2500\u2500 transformations.md\n    \u2514\u2500\u2500 scripts/\n        \u251c\u2500\u2500 explore_data.py\n        \u2514\u2500\u2500 summary_stats.py\n</code></pre>"},{"location":"guides/skills/#2-create-skillmd-with-frontmatter","title":"2. Create <code>SKILL.md</code> with Frontmatter","text":"<pre><code>---\nname: data_analysis\ndescription: High-performance data analysis - load, transform, aggregate, and visualize tabular data.\n---\n# Data Analysis Skill\nPut your detailed instructions here.\n</code></pre>"},{"location":"guides/skills/#3-pass-skills-to-the-agent-session","title":"3. Pass Skills to the Agent Session","text":"<pre><code>await using session = agent.session({\n  skillsDir: 'skills',\n  outputDir: './output',\n});\n\nawait session.run('Analyze the data using the data_analysis skill');\n</code></pre>"},{"location":"guides/skills/#how-skills-work","title":"How Skills Work","text":"<p>When you specify <code>skillsDir</code> in <code>session()</code>:</p> <ol> <li>Discovery: StirrupJS scans the directory for subdirectories containing <code>SKILL.md</code></li> <li>Metadata extraction: YAML frontmatter (<code>name</code>, <code>description</code>) is parsed from each <code>SKILL.md</code></li> <li>System prompt: Available skills are listed in the agent's system prompt</li> <li>File upload: The skills directory contents are uploaded to the execution environment under <code>skills/</code></li> </ol> <p>The agent sees something like this in its system prompt:</p> <pre><code>## Available Skills\n\nYou have access to the following skills located in the `skills/` directory. Each skill contains a SKILL.md file with detailed instructions and potentially bundled scripts.\n\nTo use a skill:\n1. Read the full instructions: `cat &lt;skill_path&gt;/SKILL.md`\n2. Follow the instructions and use any bundled resources as described\n\n- **data_analysis**: High-performance data analysis - load, transform, aggregate, and visualize tabular data. (`skills/data_analysis/SKILL.md`)\n</code></pre>"},{"location":"guides/skills/#best-practices","title":"Best Practices","text":"<ol> <li>Keep skills focused: Each skill should cover one domain well</li> <li>Provide working examples: Include quick-start snippets that run immediately</li> <li>Include decision guidance: Help the agent know when to apply the skill</li> <li>Bundle common scripts: Save agent turns with ready-to-run utilities</li> <li>Use <code>reference/</code> for depth: Keep <code>SKILL.md</code> scannable, put details in reference docs</li> </ol>"},{"location":"guides/skills/#api-reference","title":"API Reference","text":""},{"location":"guides/skills/#session-parameter","title":"<code>session()</code> Parameter","text":"<pre><code>agent.session({\n  skillsDir: 'skills',\n  // ...\n});\n</code></pre>"},{"location":"guides/sub-agents/","title":"Sub-Agents","text":"<p>Sub-agents allow you to create specialized agents and use them as tools within other agents. This enables powerful delegation patterns and modular agent architectures.</p>"},{"location":"guides/sub-agents/#overview","title":"Overview","text":"<p>A sub-agent is simply an agent converted to a tool using the <code>toTool()</code> method. The parent agent can then delegate tasks to the sub-agent by calling this tool.</p> <p>Benefits: - Specialization: Different agents for different tasks - Modularity: Reusable agent components - Context isolation: Sub-agents have separate conversation history - Simplified reasoning: Parent focuses on delegation, sub-agents on execution</p>"},{"location":"guides/sub-agents/#basic-example","title":"Basic Example","text":"<pre><code>import { Agent, SIMPLE_FINISH_TOOL, CALCULATOR_TOOL } from 'stirrupjs';\nimport { WebToolProvider } from 'stirrupjs/tools';\n\n// Create specialized sub-agents\nconst researchAgent = new Agent({\n  client,\n  name: 'researcher',\n  maxTurns: 5,\n  tools: [new WebToolProvider()],\n  finishTool: SIMPLE_FINISH_TOOL,\n  systemPrompt: 'You are a research specialist. Use web search to find accurate information.',\n});\n\nconst mathAgent = new Agent({\n  client,\n  name: 'mathematician',\n  maxTurns: 3,\n  tools: [CALCULATOR_TOOL],\n  finishTool: SIMPLE_FINISH_TOOL,\n  systemPrompt: 'You are a math specialist. Use the calculator tool for precise calculations.',\n});\n\n// Create coordinator that uses sub-agents\nconst coordinator = new Agent({\n  client,\n  name: 'coordinator',\n  maxTurns: 10,\n  tools: [\n    researchAgent.toTool('Delegate research and web search tasks'),\n    mathAgent.toTool('Delegate calculations and math problems'),\n  ],\n  finishTool: SIMPLE_FINISH_TOOL,\n  systemPrompt: `You are a task coordinator. Break down complex tasks and delegate to specialists:\n- Use 'researcher' for web research and information gathering\n- Use 'mathematician' for calculations and math problems`,\n});\n\n// Use the coordinator\nawait using session = coordinator.session();\nconst result = await session.run(`\n  What is the current population of Tokyo?\n  If it grows by 2% annually, what will the population be in 5 years?\n`);\n</code></pre>"},{"location":"guides/sub-agents/#how-it-works","title":"How It Works","text":""},{"location":"guides/sub-agents/#1-creating-sub-agents","title":"1. Creating Sub-Agents","text":"<p>Create agents with specialized capabilities:</p> <pre><code>const codeReviewer = new Agent({\n  client,\n  name: 'code-reviewer',\n  tools: [fileReadTool, grepTool],\n  finishTool: SIMPLE_FINISH_TOOL,\n  systemPrompt: 'You are an expert code reviewer. Analyze code for bugs and improvements.',\n});\n\nconst tester = new Agent({\n  client,\n  name: 'tester',\n  tools: [new LocalCodeExecToolProvider()],\n  finishTool: SIMPLE_FINISH_TOOL,\n  systemPrompt: 'You are a testing specialist. Write and run tests.',\n});\n</code></pre>"},{"location":"guides/sub-agents/#2-converting-to-tools","title":"2. Converting to Tools","text":"<p>Use <code>toTool()</code> to make agents available as tools:</p> <pre><code>const coordinator = new Agent({\n  client,\n  tools: [\n    codeReviewer.toTool('Review code for quality and bugs'),\n    tester.toTool('Write and execute tests'),\n  ],\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre>"},{"location":"guides/sub-agents/#3-delegation","title":"3. Delegation","text":"<p>The coordinator delegates by calling sub-agent tools:</p> <pre><code>// Coordinator sees sub-agents as regular tools\n// When called, sub-agent runs independently and returns results\nconst result = await coordinator.run('Review and test the authentication code');\n</code></pre>"},{"location":"guides/sub-agents/#design-patterns","title":"Design Patterns","text":""},{"location":"guides/sub-agents/#specialist-pattern","title":"Specialist Pattern","text":"<p>Multiple specialized agents for different domains:</p> <pre><code>const dataAnalyst = new Agent({\n  client,\n  name: 'analyst',\n  tools: [new LocalCodeExecToolProvider()],\n  systemPrompt: 'Data analysis specialist. Use pandas, numpy for analysis.',\n});\n\nconst visualizer = new Agent({\n  client,\n  name: 'visualizer',\n  tools: [new LocalCodeExecToolProvider()],\n  systemPrompt: 'Visualization specialist. Create charts with matplotlib.',\n});\n\nconst writer = new Agent({\n  client,\n  name: 'writer',\n  tools: [fileWriteTool],\n  systemPrompt: 'Report writing specialist. Create clear, concise reports.',\n});\n\nconst dataScience = new Agent({\n  client,\n  tools: [\n    dataAnalyst.toTool('Analyze data'),\n    visualizer.toTool('Create visualizations'),\n    writer.toTool('Write reports'),\n  ],\n});\n</code></pre>"},{"location":"guides/sub-agents/#pipeline-pattern","title":"Pipeline Pattern","text":"<p>Sequential processing through multiple agents:</p> <pre><code>const scraper = new Agent({\n  client,\n  name: 'scraper',\n  tools: [new WebToolProvider()],\n  systemPrompt: 'Extract data from websites.',\n});\n\nconst cleaner = new Agent({\n  client,\n  name: 'cleaner',\n  tools: [new LocalCodeExecToolProvider()],\n  systemPrompt: 'Clean and normalize data.',\n});\n\nconst analyzer = new Agent({\n  client,\n  name: 'analyzer',\n  tools: [new LocalCodeExecToolProvider()],\n  systemPrompt: 'Analyze data and generate insights.',\n});\n\nconst pipeline = new Agent({\n  client,\n  tools: [\n    scraper.toTool('Scrape data from URLs'),\n    cleaner.toTool('Clean and normalize data'),\n    analyzer.toTool('Analyze data'),\n  ],\n  systemPrompt: 'Process data through pipeline: scrape \u2192 clean \u2192 analyze',\n});\n</code></pre>"},{"location":"guides/sub-agents/#hierarchical-pattern","title":"Hierarchical Pattern","text":"<p>Multiple levels of delegation:</p> <pre><code>// Level 2: Specialized workers\nconst pythonExpert = new Agent({ /* ... */ });\nconst jsExpert = new Agent({ /* ... */ });\n\n// Level 1: Language coordinator\nconst coder = new Agent({\n  client,\n  tools: [\n    pythonExpert.toTool('Python tasks'),\n    jsExpert.toTool('JavaScript tasks'),\n  ],\n});\n\n// Level 0: Main coordinator\nconst projectManager = new Agent({\n  client,\n  tools: [\n    coder.toTool('Coding tasks'),\n    tester.toTool('Testing tasks'),\n    reviewer.toTool('Code review'),\n  ],\n});\n</code></pre>"},{"location":"guides/sub-agents/#communication-patterns","title":"Communication Patterns","text":""},{"location":"guides/sub-agents/#direct-task-delegation","title":"Direct Task Delegation","text":"<p>Parent provides complete task description:</p> <pre><code>await coordinator.run(`\n  Use the researcher to find:\n  1. Current Bitcoin price\n  2. 24h trading volume\n  3. Market cap\n`);\n</code></pre>"},{"location":"guides/sub-agents/#iterative-refinement","title":"Iterative Refinement","text":"<p>Parent iterates based on sub-agent results:</p> <pre><code>await coordinator.run(`\n  1. Ask researcher for sales data\n  2. If data looks incomplete, ask again with more specific query\n  3. Once you have good data, ask analyst to process it\n`);\n</code></pre>"},{"location":"guides/sub-agents/#parallel-execution","title":"Parallel Execution","text":"<p>Multiple sub-agents called independently:</p> <pre><code>await coordinator.run(`\n  In parallel:\n  - Ask researcher for market trends\n  - Ask analyst for current performance\n  Then combine results into summary\n`);\n</code></pre>"},{"location":"guides/sub-agents/#context-management","title":"Context Management","text":""},{"location":"guides/sub-agents/#isolated-contexts","title":"Isolated Contexts","text":"<p>Each sub-agent has its own conversation history:</p> <pre><code>// Researcher's context: only sees research-related conversation\n// Math agent's context: only sees math-related conversation\n// Coordinator's context: sees overall task and sub-agent results\n</code></pre>"},{"location":"guides/sub-agents/#passing-context","title":"Passing Context","text":"<p>Parent provides context in sub-agent calls:</p> <pre><code>await coordinator.run(`\n  First, use researcher to find Tokyo population.\n  Then use math agent to calculate 5-year growth at 2%.\n  Pass the population number to the math agent.\n`);\n</code></pre>"},{"location":"guides/sub-agents/#preserving-state","title":"Preserving State","text":"<p>Sub-agents don't preserve state between calls:</p> <pre><code>// Each call to sub-agent is independent\nawait coordinator.run('Ask researcher for data on topic A');\nawait coordinator.run('Ask researcher for data on topic B');\n// Researcher doesn't remember topic A\n</code></pre>"},{"location":"guides/sub-agents/#file-handling","title":"File Handling","text":""},{"location":"guides/sub-agents/#sub-agent-file-creation","title":"Sub-Agent File Creation","text":"<p>Sub-agents can create files:</p> <pre><code>const imageGen = new Agent({\n  client,\n  tools: [new LocalCodeExecToolProvider()],\n  systemPrompt: 'Create images with matplotlib',\n});\n\nconst coordinator = new Agent({\n  client,\n  tools: [imageGen.toTool('Generate images')],\n});\n\nawait using session = coordinator.session({ outputDir: './output' });\nawait session.run('Create a bar chart of sales data');\n// Files from sub-agent automatically transferred to ./output/\n</code></pre>"},{"location":"guides/sub-agents/#file-transfer","title":"File Transfer","text":"<p>Files flow from sub-agent \u2192 parent:</p> <ol> <li>Sub-agent creates file in its execution environment</li> <li>Sub-agent finishes with file in <code>paths</code> parameter</li> <li>File transferred to parent's execution environment</li> <li>Parent can use file or save to output directory</li> </ol>"},{"location":"guides/sub-agents/#monitoring-sub-agents","title":"Monitoring Sub-Agents","text":""},{"location":"guides/sub-agents/#structured-logging","title":"Structured Logging","text":"<p>Structured logging automatically tracks sub-agent activity:</p> <pre><code>import { createStructuredLogger } from 'stirrupjs';\n\nconst cleanup = createStructuredLogger(coordinator, { level: 'debug' });\n\nawait using session = coordinator.session();\nawait session.run('Complex task');\n\ncleanup();\n\n// Output shows:\n// Turn 1\n//   Tool: researcher\n//     Turn 1  (sub-agent)\n//       Tool: web_search\n//     Turn 2  (sub-agent)\n//       Tool: finish\n//   Tool: mathematician\n//     Turn 1  (sub-agent)\n//       Tool: calculator\n</code></pre>"},{"location":"guides/sub-agents/#custom-event-handlers","title":"Custom Event Handlers","text":"<p>Track sub-agent calls:</p> <pre><code>coordinator.on('tool:start', ({ name }) =&gt; {\n  if (name === 'researcher' || name === 'mathematician') {\n    console.log(`Delegating to ${name}...`);\n  }\n});\n\ncoordinator.on('tool:complete', ({ name, result }) =&gt; {\n  if (name === 'researcher' || name === 'mathematician') {\n    console.log(`${name} completed:`, result);\n  }\n});\n</code></pre>"},{"location":"guides/sub-agents/#best-practices","title":"Best Practices","text":""},{"location":"guides/sub-agents/#1-clear-specialization","title":"1. Clear Specialization","text":"<p>Give each sub-agent a focused responsibility:</p> <pre><code>// Good: Focused specialists\nconst scraper = new Agent({ /* web scraping */ });\nconst analyzer = new Agent({ /* data analysis */ });\n\n// Bad: Overlapping responsibilities\nconst dataWorker = new Agent({ /* scraping AND analysis */ });\n</code></pre>"},{"location":"guides/sub-agents/#2-appropriate-granularity","title":"2. Appropriate Granularity","text":"<p>Don't over-decompose:</p> <pre><code>// Too granular - unnecessary overhead\nconst adder = new Agent({ /* only addition */ });\nconst subtractor = new Agent({ /* only subtraction */ });\n\n// Better - appropriate scope\nconst calculator = new Agent({ /* all arithmetic */ });\n</code></pre>"},{"location":"guides/sub-agents/#3-clear-system-prompts","title":"3. Clear System Prompts","text":"<p>Help agents understand their role:</p> <pre><code>const reviewer = new Agent({\n  client,\n  systemPrompt: `You are a code reviewer. Your ONLY job is to:\n  1. Read code files\n  2. Identify bugs, performance issues, and anti-patterns\n  3. Suggest improvements\n  Do NOT write or modify code - only review.`,\n});\n</code></pre>"},{"location":"guides/sub-agents/#4-limit-recursion-depth","title":"4. Limit Recursion Depth","text":"<p>Avoid deep nesting:</p> <pre><code>// Good: 2 levels\ncoordinator \u2192 specialists \u2192 tools\n\n// Risky: 4+ levels\ncoordinator \u2192 managers \u2192 specialists \u2192 workers \u2192 tools\n</code></pre>"},{"location":"guides/sub-agents/#5-handle-sub-agent-failures","title":"5. Handle Sub-Agent Failures","text":"<p>Sub-agents might fail or produce unexpected results:</p> <pre><code>await coordinator.run(`\n  Try to get data from researcher.\n  If researcher can't find data, use fallback approach:\n  - Check local database\n  - Use cached data\n  - Report data unavailable\n`);\n</code></pre>"},{"location":"guides/sub-agents/#limitations","title":"Limitations","text":""},{"location":"guides/sub-agents/#token-usage","title":"Token Usage","text":"<p>Each sub-agent call includes: - Sub-agent's system prompt - Sub-agent's tool definitions - Sub-agent's conversation</p> <p>This increases token usage significantly.</p>"},{"location":"guides/sub-agents/#latency","title":"Latency","text":"<p>Sub-agent calls add latency: - Parent \u2192 sub-agent delegation - Sub-agent execution (multiple turns) - Result \u2192 parent</p>"},{"location":"guides/sub-agents/#complexity","title":"Complexity","text":"<p>More agents = more complexity: - Harder to debug - More failure modes - Increased token costs</p>"},{"location":"guides/sub-agents/#examples","title":"Examples","text":""},{"location":"guides/sub-agents/#complete-data-pipeline","title":"Complete Data Pipeline","text":"<pre><code>import { Agent, SIMPLE_FINISH_TOOL } from 'stirrupjs';\nimport { WebToolProvider, LocalCodeExecToolProvider } from 'stirrupjs/tools';\n\n// Fetch data from web\nconst fetcher = new Agent({\n  client,\n  name: 'fetcher',\n  maxTurns: 3,\n  tools: [new WebToolProvider()],\n  finishTool: SIMPLE_FINISH_TOOL,\n  systemPrompt: 'Fetch data from URLs and APIs.',\n});\n\n// Process and clean data\nconst processor = new Agent({\n  client,\n  name: 'processor',\n  maxTurns: 5,\n  tools: [new LocalCodeExecToolProvider()],\n  finishTool: SIMPLE_FINISH_TOOL,\n  systemPrompt: 'Clean and process data using pandas.',\n});\n\n// Create visualizations\nconst visualizer = new Agent({\n  client,\n  name: 'visualizer',\n  maxTurns: 5,\n  tools: [new LocalCodeExecToolProvider()],\n  finishTool: SIMPLE_FINISH_TOOL,\n  systemPrompt: 'Create charts with matplotlib.',\n});\n\n// Coordinate the pipeline\nconst pipeline = new Agent({\n  client,\n  name: 'pipeline',\n  maxTurns: 15,\n  tools: [\n    fetcher.toTool('Fetch data from web'),\n    processor.toTool('Process and clean data'),\n    visualizer.toTool('Create visualizations'),\n  ],\n  finishTool: SIMPLE_FINISH_TOOL,\n  systemPrompt: `Execute data pipeline:\n  1. Fetch data\n  2. Process data\n  3. Create visualizations`,\n});\n\nawait using session = pipeline.session({ outputDir: './results' });\nawait session.run('Analyze recent tech stock performance and create charts');\n</code></pre>"},{"location":"guides/sub-agents/#next-steps","title":"Next Steps","text":"<ul> <li>Creating Tools - Build custom tools</li> <li>Tool Providers - Manage tool lifecycle</li> <li>Examples - More sub-agent examples</li> </ul>"},{"location":"guides/tool-providers/","title":"Tool Providers","text":"<p>Tool providers manage tools that require lifecycle management, such as database connections, temporary directories, or external services.</p>"},{"location":"guides/tool-providers/#overview","title":"Overview","text":"<p>A tool provider implements the <code>ToolProvider</code> interface:</p> <pre><code>interface ToolProvider {\n  name: string;\n  initialize?(): Promise&lt;void&gt;;\n  getTools(): BaseTool[];\n  dispose?(): Promise&lt;void&gt;;\n}\n</code></pre> <ul> <li><code>name</code>: Unique identifier for the provider</li> <li><code>initialize()</code>: Optional setup (connections, resources)</li> <li><code>getTools()</code>: Returns array of tools</li> <li><code>dispose()</code>: Optional cleanup</li> </ul>"},{"location":"guides/tool-providers/#when-to-use-tool-providers","title":"When to Use Tool Providers","text":"<p>Use a tool provider when your tools need:</p> <ul> <li>Lifecycle management: Setup and teardown</li> <li>Shared resources: Database connections, temp directories</li> <li>State: Maintain state across tool calls</li> <li>Cleanup: Release resources properly</li> </ul> <p>Simple tools don't need providers:</p> <pre><code>// Simple tool - no provider needed\nconst calculatorTool: Tool&lt;...&gt; = {\n  name: 'calculator',\n  executor: async (params) =&gt; { /* stateless */ },\n};\n</code></pre> <p>Complex tools benefit from providers:</p> <pre><code>// Complex tool - use provider\nclass DatabaseToolProvider implements ToolProvider {\n  private connection: any;\n\n  async initialize() {\n    this.connection = await connectToDatabase();\n  }\n\n  getTools() {\n    return [queryTool, insertTool];\n  }\n\n  async dispose() {\n    await this.connection.close();\n  }\n}\n</code></pre>"},{"location":"guides/tool-providers/#built-in-providers","title":"Built-in Providers","text":""},{"location":"guides/tool-providers/#localcodeexectoolprovider","title":"LocalCodeExecToolProvider","text":"<p>Manages local code execution with temp directory:</p> <pre><code>import { LocalCodeExecToolProvider } from 'stirrupjs/tools';\n\nconst provider = new LocalCodeExecToolProvider(\n  ['python', 'node', 'uv'],  // Allowed commands\n  '/custom/temp',             // Temp directory base\n  'Custom description'        // Tool description\n);\n</code></pre>"},{"location":"guides/tool-providers/#webtoolprovider","title":"WebToolProvider","text":"<p>Manages web tools (fetch, search):</p> <pre><code>import { WebToolProvider } from 'stirrupjs/tools';\n\nconst provider = new WebToolProvider(\n  180_000,                        // Timeout (ms)\n  process.env.BRAVE_API_KEY       // Search API key\n);\n</code></pre>"},{"location":"guides/tool-providers/#dockercodeexectoolprovider","title":"DockerCodeExecToolProvider","text":"<p>Manages Docker-based code execution:</p> <pre><code>import { DockerCodeExecToolProvider } from 'stirrupjs/tools';\n\nconst provider = new DockerCodeExecToolProvider('python:3.12-slim');\n</code></pre>"},{"location":"guides/tool-providers/#e2bcodeexectoolprovider","title":"E2BCodeExecToolProvider","text":"<p>Manages E2B cloud sandbox:</p> <pre><code>import { E2BCodeExecToolProvider } from 'stirrupjs/tools';\n\nconst provider = new E2BCodeExecToolProvider({\n  apiKey: process.env.E2B_API_KEY!,\n  template: 'base',\n});\n</code></pre>"},{"location":"guides/tool-providers/#creating-custom-providers","title":"Creating Custom Providers","text":""},{"location":"guides/tool-providers/#basic-example","title":"Basic Example","text":"<pre><code>import type { ToolProvider, BaseTool } from 'stirrupjs';\n\nclass MyToolProvider implements ToolProvider {\n  name = 'my-tools';\n\n  async initialize() {\n    console.log('Setting up...');\n    // Initialize resources\n  }\n\n  getTools(): BaseTool[] {\n    return [tool1, tool2];\n  }\n\n  async dispose() {\n    console.log('Cleaning up...');\n    // Release resources\n  }\n}\n</code></pre>"},{"location":"guides/tool-providers/#database-provider-example","title":"Database Provider Example","text":"<pre><code>import { Pool } from 'pg';\nimport type { ToolProvider, Tool, ToolResult } from 'stirrupjs';\nimport { ToolUseCountMetadata } from 'stirrupjs';\nimport { z } from 'zod';\n\nclass DatabaseToolProvider implements ToolProvider {\n  name = 'database';\n  private pool: Pool;\n\n  async initialize() {\n    this.pool = new Pool({\n      connectionString: process.env.DATABASE_URL,\n      max: 10,\n    });\n  }\n\n  getTools(): BaseTool[] {\n    const QuerySchema = z.object({\n      query: z.string(),\n      params: z.array(z.any()).optional(),\n    });\n\n    const queryTool: Tool&lt;typeof QuerySchema, ToolUseCountMetadata&gt; = {\n      name: 'db_query',\n      description: 'Execute a SQL query',\n      parameters: QuerySchema,\n      executor: async (params) =&gt; {\n        try {\n          const result = await this.pool.query(params.query, params.params);\n          return {\n            content: `${result.rowCount} rows:\\n${JSON.stringify(result.rows)}`,\n            metadata: new ToolUseCountMetadata(1),\n          };\n        } catch (error) {\n          return {\n            content: `Error: ${error.message}`,\n            metadata: new ToolUseCountMetadata(1),\n          };\n        }\n      },\n    };\n\n    return [queryTool];\n  }\n\n  async dispose() {\n    await this.pool.end();\n  }\n}\n</code></pre>"},{"location":"guides/tool-providers/#file-system-provider-example","title":"File System Provider Example","text":"<pre><code>import { mkdir, rm } from 'fs/promises';\nimport { join } from 'path';\nimport type { ToolProvider } from 'stirrupjs';\n\nclass FileSystemToolProvider implements ToolProvider {\n  name = 'filesystem';\n  private workDir: string;\n\n  constructor(baseDir: string) {\n    this.workDir = join(baseDir, `session-${Date.now()}`);\n  }\n\n  async initialize() {\n    await mkdir(this.workDir, { recursive: true });\n  }\n\n  getTools() {\n    // Tools that use this.workDir\n    return [readFileTool, writeFileTool, listFilesTool];\n  }\n\n  async dispose() {\n    await rm(this.workDir, { recursive: true, force: true });\n  }\n}\n</code></pre>"},{"location":"guides/tool-providers/#using-providers-with-agents","title":"Using Providers with Agents","text":""},{"location":"guides/tool-providers/#single-provider","title":"Single Provider","text":"<pre><code>const agent = new Agent({\n  client,\n  tools: [new MyToolProvider()],\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre>"},{"location":"guides/tool-providers/#multiple-providers","title":"Multiple Providers","text":"<pre><code>const agent = new Agent({\n  client,\n  tools: [\n    new DatabaseToolProvider(),\n    new WebToolProvider(),\n    new LocalCodeExecToolProvider(),\n  ],\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre>"},{"location":"guides/tool-providers/#mix-providers-and-tools","title":"Mix Providers and Tools","text":"<pre><code>const agent = new Agent({\n  client,\n  tools: [\n    new DatabaseToolProvider(),    // Provider\n    calculatorTool,                // Simple tool\n    new WebToolProvider(),         // Provider\n  ],\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre>"},{"location":"guides/tool-providers/#lifecycle","title":"Lifecycle","text":""},{"location":"guides/tool-providers/#initialization","title":"Initialization","text":"<p>Providers are initialized when creating a session:</p> <pre><code>await using session = agent.session();\n// All providers' initialize() called here\n</code></pre>"},{"location":"guides/tool-providers/#disposal","title":"Disposal","text":"<p>Providers are disposed when session ends:</p> <pre><code>await using session = agent.session();\nawait session.run('task');\n// All providers' dispose() called here automatically\n</code></pre>"},{"location":"guides/tool-providers/#manual-control","title":"Manual Control","text":"<pre><code>const provider = new DatabaseToolProvider();\n\ntry {\n  await provider.initialize();\n  const tools = provider.getTools();\n  // Use tools\n} finally {\n  await provider.dispose();\n}\n</code></pre>"},{"location":"guides/tool-providers/#best-practices","title":"Best Practices","text":""},{"location":"guides/tool-providers/#1-initialize-resources-lazily","title":"1. Initialize Resources Lazily","text":"<p>Don't initialize until needed:</p> <pre><code>class LazyProvider implements ToolProvider {\n  private connection: any = null;\n\n  private async ensureConnected() {\n    if (!this.connection) {\n      this.connection = await connect();\n    }\n  }\n\n  getTools() {\n    return [{\n      executor: async (params) =&gt; {\n        await this.ensureConnected();\n        return await this.connection.query(params);\n      },\n    }];\n  }\n}\n</code></pre>"},{"location":"guides/tool-providers/#2-handle-errors-gracefully","title":"2. Handle Errors Gracefully","text":"<pre><code>async dispose() {\n  try {\n    await this.connection?.close();\n  } catch (error) {\n    console.error('Error closing connection:', error);\n    // Don't throw - allow other cleanup to proceed\n  }\n}\n</code></pre>"},{"location":"guides/tool-providers/#3-make-providers-configurable","title":"3. Make Providers Configurable","text":"<pre><code>class ConfigurableProvider implements ToolProvider {\n  constructor(\n    private config: {\n      timeout?: number;\n      retries?: number;\n      maxConnections?: number;\n    } = {}\n  ) {}\n\n  async initialize() {\n    this.pool = new Pool({\n      max: this.config.maxConnections ?? 10,\n    });\n  }\n}\n</code></pre>"},{"location":"guides/tool-providers/#4-document-resource-requirements","title":"4. Document Resource Requirements","text":"<pre><code>/**\n * Database tool provider\n *\n * Requires:\n * - DATABASE_URL environment variable\n * - PostgreSQL 12+\n * - Network access to database\n *\n * Resources:\n * - Creates connection pool (max 10 connections)\n * - All connections closed on dispose\n */\nclass DatabaseToolProvider implements ToolProvider {\n  // ...\n}\n</code></pre>"},{"location":"guides/tool-providers/#next-steps","title":"Next Steps","text":"<ul> <li>Creating Tools - Build custom tools</li> <li>Code Execution - Built-in tool providers</li> <li>Examples - More provider examples</li> </ul>"},{"location":"guides/tools/","title":"Creating Tools","text":"<p>This guide covers how to create custom tools for your agents.</p>"},{"location":"guides/tools/#tool-basics","title":"Tool Basics","text":"<p>A tool is an object that implements the <code>Tool</code> interface:</p> <pre><code>interface Tool&lt;P extends z.ZodType, M = unknown&gt; {\n  name: string;\n  description: string;\n  parameters: P;\n  executor: (params: z.infer&lt;P&gt;) =&gt; Promise&lt;ToolResult&lt;M&gt;&gt; | ToolResult&lt;M&gt;;\n}\n</code></pre> <ul> <li><code>name</code>: Unique tool identifier (snake_case recommended)</li> <li><code>description</code>: What the tool does (shown to the LLM)</li> <li><code>parameters</code>: Zod schema defining tool parameters</li> <li><code>executor</code>: Function that executes the tool</li> </ul>"},{"location":"guides/tools/#simple-tool-example","title":"Simple Tool Example","text":"<pre><code>import { z } from 'zod';\nimport type { Tool, ToolResult } from 'stirrupjs';\nimport { ToolUseCountMetadata } from 'stirrupjs';\n\n// 1. Define parameter schema\nconst GreetParamsSchema = z.object({\n  name: z.string().describe('Name of person to greet'),\n  language: z.enum(['english', 'spanish', 'french']).default('english'),\n});\n\n// 2. Create tool\nconst greetTool: Tool&lt;typeof GreetParamsSchema, ToolUseCountMetadata&gt; = {\n  name: 'greet',\n  description: 'Greet a person in different languages',\n  parameters: GreetParamsSchema,\n  executor: async (params) =&gt; {\n    const greetings = {\n      english: `Hello, ${params.name}!`,\n      spanish: `\u00a1Hola, ${params.name}!`,\n      french: `Bonjour, ${params.name}!`,\n    };\n\n    return {\n      content: greetings[params.language],\n      metadata: new ToolUseCountMetadata(1),\n    };\n  },\n};\n\n// 3. Use with agent\nconst agent = new Agent({\n  client,\n  tools: [greetTool],\n  finishTool: SIMPLE_FINISH_TOOL,\n});\n</code></pre>"},{"location":"guides/tools/#parameter-schemas","title":"Parameter Schemas","text":"<p>Use Zod to define tool parameters. The LLM sees the schema and descriptions when deciding how to call your tool.</p>"},{"location":"guides/tools/#basic-types","title":"Basic Types","text":"<pre><code>const schema = z.object({\n  // Primitives\n  text: z.string().describe('A string value'),\n  count: z.number().describe('A number'),\n  enabled: z.boolean().describe('A boolean flag'),\n\n  // With defaults\n  language: z.string().default('en'),\n  retries: z.number().default(3),\n\n  // Optional fields\n  optional: z.string().optional().describe('An optional field'),\n\n  // Enums\n  mode: z.enum(['fast', 'accurate', 'balanced']).describe('Processing mode'),\n\n  // Arrays\n  tags: z.array(z.string()).describe('List of tags'),\n  scores: z.array(z.number()).describe('Array of scores'),\n});\n</code></pre>"},{"location":"guides/tools/#complex-types","title":"Complex Types","text":"<pre><code>const schema = z.object({\n  // Nested objects\n  user: z.object({\n    name: z.string(),\n    email: z.string().email(),\n  }),\n\n  // Union types\n  value: z.union([z.string(), z.number()]),\n\n  // Records/dictionaries\n  metadata: z.record(z.string()),\n\n  // Refined validation\n  port: z.number().min(1).max(65535),\n  email: z.string().email(),\n  url: z.string().url(),\n});\n</code></pre>"},{"location":"guides/tools/#descriptions","title":"Descriptions","text":"<p>Always add <code>.describe()</code> to parameters - the LLM uses these to understand what to provide:</p> <pre><code>z.object({\n  query: z.string().describe('SQL query to execute. Use parameterized queries for safety.'),\n  timeout: z.number().default(30).describe('Query timeout in seconds'),\n  limit: z.number().optional().describe('Maximum number of rows to return'),\n});\n</code></pre>"},{"location":"guides/tools/#tool-results","title":"Tool Results","text":"<p>Tools return a <code>ToolResult</code>:</p> <pre><code>interface ToolResult&lt;M = unknown&gt; {\n  content: string | ContentBlock[];\n  metadata?: M;\n}\n</code></pre>"},{"location":"guides/tools/#text-results","title":"Text Results","text":"<pre><code>executor: async (params) =&gt; {\n  const result = await someOperation(params);\n  return {\n    content: `Operation completed: ${result}`,\n    metadata: new ToolUseCountMetadata(1),\n  };\n}\n</code></pre>"},{"location":"guides/tools/#structured-results","title":"Structured Results","text":"<pre><code>executor: async (params) =&gt; {\n  const data = await fetchData(params);\n  return {\n    content: JSON.stringify(data, null, 2),\n    metadata: new ToolUseCountMetadata(1),\n  };\n}\n</code></pre>"},{"location":"guides/tools/#image-results","title":"Image Results","text":"<pre><code>import { ImageContentBlock } from 'stirrupjs';\n\nexecutor: async (params) =&gt; {\n  const imageData = await generateImage(params);\n  return {\n    content: [\n      new ImageContentBlock(\n        imageData,      // Buffer or base64 string\n        'image/png',    // MIME type\n        'chart.png'     // Optional filename\n      ),\n    ],\n    metadata: new ToolUseCountMetadata(1),\n  };\n}\n</code></pre>"},{"location":"guides/tools/#error-handling","title":"Error Handling","text":"<pre><code>executor: async (params) =&gt; {\n  try {\n    const result = await riskyOperation(params);\n    return {\n      content: `Success: ${result}`,\n      metadata: new ToolUseCountMetadata(1),\n    };\n  } catch (error) {\n    return {\n      content: `Error: ${error instanceof Error ? error.message : String(error)}`,\n      metadata: new ToolUseCountMetadata(1),\n    };\n  }\n}\n</code></pre>"},{"location":"guides/tools/#tool-metadata","title":"Tool Metadata","text":"<p>Metadata tracks tool usage and custom information:</p> <pre><code>class ToolUseCountMetadata {\n  numUses: number;\n\n  constructor(count: number = 1) {\n    this.numUses = count;\n  }\n\n  merge(other: ToolUseCountMetadata): ToolUseCountMetadata {\n    return new ToolUseCountMetadata(this.numUses + other.numUses);\n  }\n}\n</code></pre> <p>Access aggregated metadata in results:</p> <pre><code>const result = await session.run('task');\nconsole.log(result.runMetadata.my_tool); // { numUses: 3 }\n</code></pre>"},{"location":"guides/tools/#custom-metadata","title":"Custom Metadata","text":"<pre><code>class ApiCallMetadata {\n  numCalls: number = 0;\n  totalLatency: number = 0;\n\n  merge(other: ApiCallMetadata): ApiCallMetadata {\n    const merged = new ApiCallMetadata();\n    merged.numCalls = this.numCalls + other.numCalls;\n    merged.totalLatency = this.totalLatency + other.totalLatency;\n    return merged;\n  }\n}\n\nconst tool: Tool&lt;typeof schema, ApiCallMetadata&gt; = {\n  name: 'api_call',\n  description: 'Call external API',\n  parameters: schema,\n  executor: async (params) =&gt; {\n    const start = Date.now();\n    const result = await fetch(params.url);\n    const latency = Date.now() - start;\n\n    const metadata = new ApiCallMetadata();\n    metadata.numCalls = 1;\n    metadata.totalLatency = latency;\n\n    return {\n      content: await result.text(),\n      metadata,\n    };\n  },\n};\n</code></pre>"},{"location":"guides/tools/#real-world-examples","title":"Real-World Examples","text":""},{"location":"guides/tools/#http-api-tool","title":"HTTP API Tool","text":"<pre><code>const HttpRequestParamsSchema = z.object({\n  url: z.string().url().describe('URL to fetch'),\n  method: z.enum(['GET', 'POST', 'PUT', 'DELETE']).default('GET'),\n  headers: z.record(z.string()).optional().describe('HTTP headers'),\n  body: z.string().optional().describe('Request body (JSON string)'),\n});\n\nconst httpTool: Tool&lt;typeof HttpRequestParamsSchema, ToolUseCountMetadata&gt; = {\n  name: 'http_request',\n  description: 'Make HTTP requests to external APIs',\n  parameters: HttpRequestParamsSchema,\n  executor: async (params) =&gt; {\n    try {\n      const response = await fetch(params.url, {\n        method: params.method,\n        headers: params.headers,\n        body: params.body,\n      });\n\n      const data = await response.text();\n\n      return {\n        content: `Status: ${response.status}\\n\\n${data}`,\n        metadata: new ToolUseCountMetadata(1),\n      };\n    } catch (error) {\n      return {\n        content: `HTTP Error: ${error.message}`,\n        metadata: new ToolUseCountMetadata(1),\n      };\n    }\n  },\n};\n</code></pre>"},{"location":"guides/tools/#file-system-tool","title":"File System Tool","text":"<pre><code>import { readFile, writeFile } from 'fs/promises';\n\nconst FileReadParamsSchema = z.object({\n  path: z.string().describe('File path to read'),\n  encoding: z.enum(['utf-8', 'base64']).default('utf-8'),\n});\n\nconst fileReadTool: Tool&lt;typeof FileReadParamsSchema, ToolUseCountMetadata&gt; = {\n  name: 'read_file',\n  description: 'Read contents of a file',\n  parameters: FileReadParamsSchema,\n  executor: async (params) =&gt; {\n    try {\n      const content = await readFile(params.path, params.encoding as BufferEncoding);\n      return {\n        content: `File contents:\\n${content}`,\n        metadata: new ToolUseCountMetadata(1),\n      };\n    } catch (error) {\n      return {\n        content: `Error reading file: ${error.message}`,\n        metadata: new ToolUseCountMetadata(1),\n      };\n    }\n  },\n};\n</code></pre>"},{"location":"guides/tools/#database-tool","title":"Database Tool","text":"<pre><code>import { Pool } from 'pg';\n\nconst pool = new Pool({ connectionString: process.env.DATABASE_URL });\n\nconst DbQueryParamsSchema = z.object({\n  query: z.string().describe('SQL query to execute'),\n  params: z.array(z.any()).optional().describe('Query parameters for safety'),\n});\n\nconst dbQueryTool: Tool&lt;typeof DbQueryParamsSchema, ToolUseCountMetadata&gt; = {\n  name: 'db_query',\n  description: 'Execute a SQL query. Always use parameterized queries.',\n  parameters: DbQueryParamsSchema,\n  executor: async (params) =&gt; {\n    try {\n      const result = await pool.query(params.query, params.params);\n      return {\n        content: `Query returned ${result.rowCount} rows:\\n${JSON.stringify(result.rows, null, 2)}`,\n        metadata: new ToolUseCountMetadata(1),\n      };\n    } catch (error) {\n      return {\n        content: `Database error: ${error.message}`,\n        metadata: new ToolUseCountMetadata(1),\n      };\n    }\n  },\n};\n</code></pre>"},{"location":"guides/tools/#best-practices","title":"Best Practices","text":""},{"location":"guides/tools/#1-clear-descriptions","title":"1. Clear Descriptions","text":"<p>Write descriptions that help the LLM understand when and how to use your tool:</p> <pre><code>// Good\ndescription: 'Search the product database by name, category, or SKU. Returns matching products with prices and availability.'\n\n// Bad\ndescription: 'Search products'\n</code></pre>"},{"location":"guides/tools/#2-validate-input","title":"2. Validate Input","text":"<p>Use Zod's validation features:</p> <pre><code>const schema = z.object({\n  port: z.number().min(1).max(65535).describe('Port number (1-65535)'),\n  email: z.string().email().describe('Valid email address'),\n  url: z.string().url().describe('Valid HTTP/HTTPS URL'),\n});\n</code></pre>"},{"location":"guides/tools/#3-handle-errors-gracefully","title":"3. Handle Errors Gracefully","text":"<p>Return errors as content rather than throwing:</p> <pre><code>executor: async (params) =&gt; {\n  try {\n    return { content: await doWork(params), metadata };\n  } catch (error) {\n    // Return error as content so agent can handle it\n    return {\n      content: `Error: ${error.message}. Try a different approach.`,\n      metadata\n    };\n  }\n}\n</code></pre>"},{"location":"guides/tools/#4-provide-structured-output","title":"4. Provide Structured Output","text":"<p>Help the agent understand results:</p> <pre><code>return {\n  content: `\nResults: 3 items found\n\n1. Item: Widget A\n   Price: $29.99\n   Stock: 15 units\n\n2. Item: Widget B\n   Price: $34.99\n   Stock: 8 units\n\n3. Item: Widget C\n   Price: $39.99\n   Stock: 0 units (out of stock)\n`,\n  metadata,\n};\n</code></pre>"},{"location":"guides/tools/#5-use-appropriate-types","title":"5. Use Appropriate Types","text":"<pre><code>// Good: Specific enum\nmode: z.enum(['read', 'write', 'append'])\n\n// Bad: Vague string\nmode: z.string()\n</code></pre>"},{"location":"guides/tools/#next-steps","title":"Next Steps","text":"<ul> <li>Tool Providers - Managing tool lifecycle</li> <li>Sub-Agents - Using agents as tools</li> <li>Code Execution - Built-in code execution tools</li> <li>Examples - More tool examples</li> </ul>"}]}